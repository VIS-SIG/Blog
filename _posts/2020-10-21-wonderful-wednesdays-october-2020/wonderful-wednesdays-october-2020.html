<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

  <!--radix_placeholder_meta_tags-->
  <title>Wonderful Wednesdays October 2020</title>
  
  <meta property="description" itemprop="description" content="Abi Williams presented data visualisations on co-occurrence of adverse events. How to display events that occur at the same time in the same patient and highlight differences of treatment or gender? A variety of very different approaches was discussed. The first visualisation was a heatmap for the frequency of co-occurrences. A Lollipop plot combined the frequency with the overlap time. Then a Shiny App made interactive exploration of up to 4 co-occurring events possible. The presentation of an UpSet plot brought up a discussion on the advantages over the vinn diagram. The shiny app AdEPro was referred to as an useful exploration tool for adverse event in general. Another tool for exploring the co-occurrence in particular was the force directed network graph. The final approach was embedded in a PowerBI Dashboard."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-10-14"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-10-14"/>
  <meta name="article:author" content="Steve Mallett"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Wonderful Wednesdays October 2020"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Abi Williams presented data visualisations on co-occurrence of adverse events. How to display events that occur at the same time in the same patient and highlight differences of treatment or gender? A variety of very different approaches was discussed. The first visualisation was a heatmap for the frequency of co-occurrences. A Lollipop plot combined the frequency with the overlap time. Then a Shiny App made interactive exploration of up to 4 co-occurring events possible. The presentation of an UpSet plot brought up a discussion on the advantages over the vinn diagram. The shiny app AdEPro was referred to as an useful exploration tool for adverse event in general. Another tool for exploring the co-occurrence in particular was the force directed network graph. The final approach was embedded in a PowerBI Dashboard."/>
  <meta property="og:image" content="https://vis-sig.github.io/blog/./images/plot01.png"/>
  <meta property="og:image:width" content="4133"/>
  <meta property="og:image:height" content="2362"/>
  <meta property="og:locale" content="en_US"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary_large_image"/>
  <meta property="twitter:title" content="Wonderful Wednesdays October 2020"/>
  <meta property="twitter:description" content="Abi Williams presented data visualisations on co-occurrence of adverse events. How to display events that occur at the same time in the same patient and highlight differences of treatment or gender? A variety of very different approaches was discussed. The first visualisation was a heatmap for the frequency of co-occurrences. A Lollipop plot combined the frequency with the overlap time. Then a Shiny App made interactive exploration of up to 4 co-occurring events possible. The presentation of an UpSet plot brought up a discussion on the advantages over the vinn diagram. The shiny app AdEPro was referred to as an useful exploration tool for adverse event in general. Another tool for exploring the co-occurrence in particular was the force directed network graph. The final approach was embedded in a PowerBI Dashboard."/>
  <meta property="twitter:image" content="https://vis-sig.github.io/blog/./images/plot01.png"/>
  <meta property="twitter:image:width" content="4133"/>
  <meta property="twitter:image:height" content="2362"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","base_url","preview","output"]}},"value":[{"type":"character","attributes":{},"value":["Wonderful Wednesdays October 2020"]},{"type":"character","attributes":{},"value":["Abi Williams presented data visualisations on co-occurrence of adverse events. How to display events that occur at the same time in the same patient and highlight differences of treatment or gender? A variety of very different approaches was discussed. The first visualisation was a heatmap for the frequency of co-occurrences. A Lollipop plot combined the frequency with the overlap time. Then a Shiny App made interactive exploration of up to 4 co-occurring events possible. The presentation of an UpSet plot brought up a discussion on the advantages over the vinn diagram. The shiny app AdEPro was referred to as an useful exploration tool for adverse event in general. Another tool for exploring the co-occurrence in particular was the force directed network graph. The final approach was embedded in a PowerBI Dashboard.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Steve Mallett"]},{"type":"character","attributes":{},"value":["https://www.psiweb.org/sigs-special-interest-groups/visualisation"]}]}]},{"type":"character","attributes":{},"value":["10-14-2020"]},{"type":"character","attributes":{},"value":["Adverse events","Co-occurence","Wonderful Wednesdays"]},{"type":"character","attributes":{},"value":["https://vis-sig.github.io/blog"]},{"type":"character","attributes":{},"value":["./images/plot01.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["images/plot01.png","images/plot02.png","images/plot03.png","images/plot04.png","images/plot05.png","images/plot06.png","images/plot07.png","wonderful-wednesdays-october-2020_files/bowser-1.9.3/bowser.min.js","wonderful-wednesdays-october-2020_files/distill-2.2.21/template.v2.js","wonderful-wednesdays-october-2020_files/jquery-1.11.3/jquery.min.js","wonderful-wednesdays-october-2020_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for table of contents */
  
  .d-toc {
    color: rgba(0,0,0,0.8);
    font-size: 0.8em;
    line-height: 1em;
  }
  
  .d-toc-header {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(0, 0, 0, 0.5);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 1.3em;
  }
  
  .d-toc a {
    border-bottom: none;
  }
  
  .d-toc ul {
    padding-left: 0;
  }
  
  .d-toc li>ul {
    padding-top: 0.8em;
    padding-left: 16px;
    margin-bottom: 0.6em;
  }
  
  .d-toc ul,
  .d-toc li {
    list-style-type: none;
  }
  
  .d-toc li {
    margin-bottom: 0.9em;
  }
  
  .d-toc-separator {
    margin-top: 20px;
    margin-bottom: 2em;
  }
  
  .d-article-with-toc {
    border-top: none;
    padding-top: 0;
  }
  
  
  
  /* Tweak code blocks (note that this CSS is repeated above in an injection
     into the d-code shadow dom) */
  
  d-code {
    overflow-x: auto !important;
  }
  
  pre.d-code code.d-code {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  pre.text-output {
  
    font-size: 12px;
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  @media(min-width: 768px) {
  
  d-code {
    overflow-x: visible !important;
  }
  
  pre.d-code code.d-code  {
      padding-left: 18px;
      font-size: 14px;
  }
  pre.text-output {
    font-size: 14px;
  }
  }
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // create d-bibliography
    var bibliography = $('<d-bibliography></d-bibliography>');
    $('#distill-bibliography').wrap(bibliography);
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace citations with <d-cite>
    $('.citation').each(function(i, val) {
      appendix = true;
      var cites = $(this).attr('data-cites').split(" ");
      var dt_cite = $('<d-cite></d-cite>');
      dt_cite.attr('key', cites.join());
      $(this).replaceWith(dt_cite);
    });
    // remove refs
    $('#refs').remove();
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-toc a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // replace code blocks with d-code
    $('pre>code').each(function(i, val) {
      var code = $(this);
      var pre = code.parent();
      var clz = "";
      var language = pre.attr('class');
      if (language) {
        // map unknown languages to "clike" (without this they just dissapear)
        if ($.inArray(language, ["bash", "clike", "css", "go", "html",
                                 "javascript", "js", "julia", "lua", "markdown",
                                 "markup", "mathml", "python", "svg", "xml"]) == -1)
          language = "clike";
        language = ' language="' + language + '"';
        var dt_code = $('<d-code block' + language + clz + '></d-code>');
        dt_code.text(code.text());
        pre.replaceWith(dt_code);
      } else {
        code.addClass('text-output').unwrap().changeElementType('pre');
      }
    });
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('d-code, pre.text-output, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // table of contents
      if (have_authors) // adjust border if we are in authors
        $('.d-toc').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // inject pre code styles (can't do this with a global stylesheet b/c a shadow root is used)
      $('d-code').each(function(i, val) {
        var style = document.createElement('style');
        style.innerHTML = 'pre code { padding-left: 10px; font-size: 12px; border-left: 2px solid rgba(0,0,0,0.1); } ' +
                          '@media(min-width: 768px) { pre code { padding-left: 18px; font-size: 14px; } }';
        if (this.shadowRoot)
          this.shadowRoot.appendChild(style);
      });
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-toc-header').remove();
    $('.d-toc').remove();
    $('.d-toc-separator').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="wonderful-wednesdays-october-2020_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="wonderful-wednesdays-october-2020_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="wonderful-wednesdays-october-2020_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="wonderful-wednesdays-october-2020_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Wonderful Wednesdays October 2020","description":"Abi Williams presented data visualisations on co-occurrence of adverse events. How to display events that occur at the same time in the same patient and highlight differences of treatment or gender? A variety of very different approaches was discussed. The first visualisation was a heatmap for the frequency of co-occurrences. A Lollipop plot combined the frequency with the overlap time. Then a Shiny App made interactive exploration of up to 4 co-occurring events possible. The presentation of an UpSet plot brought up a discussion on the advantages over the vinn diagram. The shiny app AdEPro was referred to as an useful exploration tool for adverse event in general. Another tool for exploring the co-occurrence in particular was the force directed network graph. The final approach was embedded in a PowerBI Dashboard.","authors":[{"author":"Steve Mallett","authorURL":"https://www.psiweb.org/sigs-special-interest-groups/visualisation","affiliation":"&nbsp;","affiliationURL":"#"}],"publishedDate":"2020-10-14T00:00:00.000+02:00","citationText":"Mallett, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Wonderful Wednesdays October 2020</h1>
<p>Abi Williams presented data visualisations on co-occurrence of adverse events. How to display events that occur at the same time in the same patient and highlight differences of treatment or gender? A variety of very different approaches was discussed. The first visualisation was a heatmap for the frequency of co-occurrences. A Lollipop plot combined the frequency with the overlap time. Then a Shiny App made interactive exploration of up to 4 co-occurring events possible. The presentation of an UpSet plot brought up a discussion on the advantages over the vinn diagram. The shiny app AdEPro was referred to as an useful exploration tool for adverse event in general. Another tool for exploring the co-occurrence in particular was the force directed network graph. The final approach was embedded in a PowerBI Dashboard.</p>
</div>

<div class="d-byline">
  Steve Mallett <a href="https://www.psiweb.org/sigs-special-interest-groups/visualisation" class="uri">https://www.psiweb.org/sigs-special-interest-groups/visualisation</a> 
  
<br/>10-14-2020
</div>

<div class="d-article">
<h1 id="adverse-event-co-occurrence-challenge"><em>Adverse Event Co-Occurrence Challenge</em></h1>
<p>This month’s challenge was based on a clinical trial for the treatment of Type II diabetes in adults that cannot manage their blood glucose control with a single oral therapy. The primary outcome in the trial was mean HbA1c at 6 months, and adverse events (AEs) were monitored and collected for the entire course of the study.</p>
<p>The data visualisation objectives were focussed on AEs, and were defined as follows:</p>
<ul>
<li>To quickly identify groupings of AEs that occur in the same patients at the same time in Treatment A.</li>
<li>Do these groupings occur in Treatment B?</li>
<li>Is there a difference based on sex?</li>
<li>Are adverse events in these groupings severe?</li>
</ul>
<p>The dataset is available <a href="https://github.com/VIS-SIG/Wonderful-Wednesdays/tree/master/data/2020/2020-09-09">here</a>.</p>
<p><a id="example1"></a></p>
<h2 id="example-1.-heat-map"><span style="color:blue">Example 1. Heat Map</span></h2>
<p><img src="images/plot01.png" /></p>
<p>Included here is one of two heat map charts that were submitted. The graph shows pairs of AE terms represented as a grid, with one of each pair included on either the horizontal or vertical axis, and with the frequency of co-occurrences of each pair of terms being colour-coded. The plot shows quite clearly that Nausea and Vomiting are terms that co-occur at the highest frequency.</p>
<p>The judging panel suggested a few possible enhancements. There is quite a lot of white space in this plot, and it was felt this plot might be more useful for exploring a larger dataset containing many co-occurring terms. It would then be useful to be able to limit the data displayed to only include pairs of terms with a frequency above a cut-off value, to focus on the more prevalent co-occurrences. A more meaningful method of sorting the AE terms might also be helpful. A comment was made that the eye tends to be drawn towards the dark blue areas of the plot, whereas these only represent a relatively small number of patients. The real “story” in this plot, i.e. co-occurrence of Nausea/Vomiting, would perhaps come through more strongly if darker tones were used for increasing frequency. Also, adding some additional contextual information to the plot would help the user to better understand what is being shown (for example that the frequency relates to co-occurrences of the pairs of AE terms.)</p>
<p>A general comment on heatmaps is that representing a variable on a continuous colour scale can make it difficult for the user to accurately translate the frequencies into a quantitative value. Therefore a further enhancement might be to create ordered categories for frequency of occurrence, comprising perhaps 5-7 bins.</p>
<p><a href="#example1%20code">link to code</a></p>
<p><a id="example2"></a></p>
<h2 id="example-2.-lollipop-chart"><span style="color:blue">Example 2. Lollipop Chart</span></h2>
<p><img src="images/plot02.png" /></p>
<p>This plot also shows the frequencies of co-occurring pairs of AE terms, but includes the additional dimension of showing the median time of co-occurrence as a lollipop chart. When representing a quantitative measure as the distance along an axis, common choices of chart type are often either bar charts or dot plots. The latter is sometimes preferred because of the lower “data to ink ratio” (as proposed by Edward Tufte) which may produce a plot with a clearer message. The lollipop chart is a compromise between these two options, where the length of the “stick” represents, in this case, the median overlap time. This leads to the possibility of using the stick to encode an additional variable, e.g. adding colour or line thickness, although care would be needed not to overcomplicate the graph.</p>
<p>The panel appreciated the fact that the title includes the key message that the chart is communicating. An enhancement might be to remove the “n=” labels above each “lollipop”, as this information is already encoded in the size of the bubble, and would produce a cleaner looking plot. Also, the switching to a vertical format would make the labels easier to read, and meaningful sorting (e.g. by bubble size or median overlap) would enhance the chart. Also, perhaps applying a cut-off value (e.g. to remove the pairs of terms that only co-occur in a single patient) would be helpful. The above features are seen in some of the other submitted graphs (for example the Shiny App described in the next section). The graph is not providing a comparison of the two treatment groups, so this would be a further enhancement (e.g. splitting the graph into two panels in a vertical format).</p>
<p><a href="#example1%20code">link to code</a></p>
<p><a id="example3"></a></p>
<h2 id="example-3.-rshiny-app"><span style="color:blue">Example 3. RShiny App</span></h2>
<p><img src="images/plot03.png" /></p>
<p>This Shiny App can be accessed by clicking <a href="https://figplot.shinyapps.io/WW20201014/">here</a>. The previous plots have focussed on pairs of co-occurring AE terms, but this app provides the ability to choose the number of co-occurring terms, i.e. 2-4 terms. The initial screen displays diverging bar charts, showing mean duration of co-occurring terms on the left side and number of patients with overlapping occurrences on the right side, split by treatment group. The AE terms can be sorted by mean duration or frequency of co-occurrences, and the data can also be split by treatment and gender. The app can also display individual patient-level profiles with various display and filtering options.</p>
<p>The app was well received as a very useful and flexible tool for exploring the data. One of the design features that were appreciated included the inclusion of the statistic at the end of the bars. For the diverging bar charts, a legend is shown representing treatment group categories, but this colour-coding only seems to apply to the right-hand side of the diverging bar chart, i.e. showing the frequency of co-occurrences. However it wasn’t clear whether bar chart on left-hand side, showing the mean duration, were also split by treatment, and if so, what colour-coding scheme would apply to this part of the chart. (This is not clear because no combinations of AE terms occurred in more than one treatment group)</p>
<p>A further enhancement might be for the user to be able to choose cut-off values for the number of co-occurring terms (e.g. &gt;=2 terms, &gt;=3 terms) rather than having to choose the exact number of terms. A further comment on the design is that the numbers at the top of the screen, showing the total number of patients and total number of AEs occurring at the same time, are disproportionately large and reminiscent of an “infographic” style (which is not popular with some members of the panel). These numbers could be moved elsewhere (e.g. panel on the left containing a lot of blank space) to draw more attention to the main plot.</p>
<p><a id="example4"></a></p>
<h2 id="example-4.-upset-plot"><span style="color:blue">Example 4. Upset Plot</span></h2>
<p><img src="images/plot04.png" /></p>
<p>This is a useful plot for displaying frequency counts where there is interest in the intersections of different categories, having a similar function to a Venn diagram but being much more practical where there are more than three categories. (It will always be possible to produce an Upset plot, regardless of the number of categories, whereas a Venn diagram quickly becomes impossible to produce or interpret beyond 4 or 5 categories.) The vertical bar chart shows the size of the various intersections (which is highlighting that Nausea and Vomiting is the most frequently-occurring pair of terms), and the horizontal bar chart shows the frequency of each individual category (showing that overall, Nasopharyngitis, Nausea and Vomiting are the most frequent, with a dramatic drop-off in the frequencies of other terms).</p>
<p>The plot requires a fair amount of explanation, and would work well with stakeholders who are already familiar with the format. It wouldn’t work so well at a conference, for example, where there isn’t the opportunity to explain the graph. Improved labelling (e.g. interpretation of “Intersection Size”) would make the graph easier to understand.</p>
<p>Where there is a large number of categories (as in this example), displaying all of the combinations of categories is limited by the display area of the plot. In this case a “cut-off” has been applied to limit to an intersection size of 20. Ideally the graph would include interactivity, to allow the user to define which categories are displayed. In addition, the aspect ratio is challenging to display in a landscape screen, so flexibility in the layout of the various charts would be useful.</p>
<p><a href="#example4%20code">link to code</a></p>
<p><a id="example5"></a></p>
<h2 id="example-5.-adepro"><span style="color:blue">Example 5. ADEPRO</span></h2>
<p><img src="images/plot05.png" /></p>
<p>This app provides interactive exploration of AE data at the individual patient level. Each patient is represented as a grey circle, with coloured wedges within each circle mapped to different adverse event terms. Clicking the play button starts an animation running, with the elapsed time since the start of the study shown as a blue bar at the top of the screen. As time progresses, filled coloured wedges appear within the grey circles at the appropriate time of onset of each respective AE. Coloured outline wedges represents AEs have occurred at a previous time during the study but have resolved.</p>
<p>Applying this app to the current challenge, co-occurring AE terms can be viewed by running the animation and observing circles with more than one coloured wedge at the same time. The outlined wedges, representing resolved AEs, did not necessarily co-occur, so the app relies on the user manually identifying the co-occurring AEs in real time as the animation progresses. The app doesn’t provide an overall summary, so requires some input from the user to produce any required statistics, e.g. frequency counts, after viewing the animation.</p>
<p><a href="#example5%20code">link to code</a></p>
<p><a id="example6"></a></p>
<h2 id="example-6.-network"><span style="color:blue">Example 6. Network</span></h2>
<p><img src="images/plot06.png" /></p>
<p>The network diagram shown is a screenshot from an interactive app, which produces a network diagram displaying AE terms as nodes. The size of each node represents the incidence rate, and nodes are connected according to whether they co-occur in the same subject. The thickness of the lines represents the strength of the association in terms of frequency of co-occurrences. The nodes are colour-coded to represent the severity of the AEs. When each node in the network is clicked on, this displays all other AE terms that co-occurred with the selected term. The app also includes options for filtering the data, selecting the minimum and maximum frequency, and also defining the time window used for co-occurrences (e.g. AEs at exactly the same , within a +/- 2 day window etc.). Further filter options include severity and gender. The app also includes useful display options, e.g. font size.</p>
<p>Although the plot is visually complex in terms of the large number of AE terms with overlapping terms and many connecting lines, in this case the message is quite clear because only four AE terms are dominant in the graph.</p>
<p><a id="example7"></a></p>
<h2 id="example-7.-apriori-algorithm"><span style="color:blue">Example 7. Apriori Algorithm</span></h2>
<p><img src="images/plot07.png" /></p>
<p>This is an example of a Power BI dashboard, with a set of interactive filters on the left part of the screen, and right panel displaying the output from an algorithm called Apriori. The right panel displays a series of coloured nodes of varying size and colour saturation, and with arrows entering and leaving the circles at various points. The dynamic updating of the plot, by clicking on the filters, was a useful feature that was appreciated by the panel, as were several aspect of the design that are visually appealing and quite effective.</p>
<p>However the algorithm behind the plot was not familiar to the panel, who therefore struggled to interpret the message behind the graph. It was concerning that some of the associations that were strongly identified in some of the other plots (e.g. strong co-occurrence of Nausea and Vomiting) was not clearly shown in this plot.</p>
<h1 id="code"><span style="color:red"><em>Code</em></span></h1>
<p><a id="example1 code"></a></p>
<h2 id="examples-1-and-2.-heat-map-and-lollipop-plot"><span style="color:red">Examples 1 and 2. Heat Map and Lollipop Plot</span></h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
library(tidyverse)
#Colour scheme
Orange &lt;- &quot;#EF7F04&quot;
Green &lt;- &quot;#68B937&quot;
Blue &lt;- &quot;#00A6CB&quot;
Grey &lt;- &quot;#4E5053&quot;
Darkblue &lt;- &quot;#003569&quot;
Yellow &lt;- &quot;#FFBB2D&quot; 
GreyedOut &lt;- &quot;#D3D3D3&quot;

setwd(&quot;C:/Users/Q1062810/Documents/Wonderful Wednesday/AE2&quot;)

# Read in the data and make a unique subject ID based on the subjid and treatment
AE &lt;- read.csv(&quot;AE.csv&quot;) %&gt;%
  mutate(USUBJID = paste(Treatment, Subject, sep = &#39;_&#39;)) %&gt;%
  mutate(Adverse = as.character(Adverse))

#Make a dataset where subjects have more than one event (because we are looking for co-occurring events)
AE_events &lt;- AE %&gt;%
  group_by(USUBJID) %&gt;%
  filter(n() &gt; 1) %&gt;%
  ungroup() %&gt;%
  select(c(2,4,5,7,8,9)) %&gt;% # Select the columns we care about
  rename(Adverse2=Adverse) %&gt;% # Rename all the relevant variables  with a &quot;2&quot; as we will merge these back on to the initial dataset 
  rename(Start2 = Start) %&gt;%
  rename(End2=End) %&gt;%
  rename(System2=System) %&gt;%
  rename(Severity2=Severity)
  
# Match merge the filtered data set onto the original data set by subject ID. 
# This gives us a data set which has every combination of AEs for all subjects which have more than 1 AE
AE_combined &lt;- left_join(AE,AE_events) %&gt;%
  rownames_to_column(&quot;combination_ID&quot;) %&gt;%
  mutate(overlap = if_else(condition = Start &gt;= Start2 &amp; Start &lt;= End2,true = 1, # Makes a flag to capture the events with overlap
                           false = if_else(condition=End &gt;= Start2 &amp; End &lt;= End2, true = 1, 
                                           false = if_else(condition=Start2 &gt;= Start &amp; Start2 &lt;= End, true = 1,
                                                           if_else(condition=End2 &gt;= Start &amp; End2 &lt;= End, true = 1,false = 0))))) %&gt;%
  mutate(different = if_else(condition= Adverse==Adverse2,true = 0,false = 1)) %&gt;% # Makes a flag for all events where the AEs are duplicated as part of the merge process. this helps us remove these events
  mutate(Co_start = pmax(Start,Start2)) %&gt;% 
  mutate(Co_end = pmin(End,End2)) %&gt;%
  mutate(Time =Co_end - Co_start) %&gt;% # Create a variable representing total overlap time
  filter(overlap==1 &amp; different==1) %&gt;% # filter just overlapping AEs  
  select(c(&quot;USUBJID&quot;,&quot;Adverse&quot;,&quot;Adverse2&quot;, &quot;Time&quot;,&quot;Treatment&quot;)) %&gt;% # Select relevant columns
  arrange(Adverse,Adverse2)



library(plyr)
AE_crosstab &lt;- count(AE_combined, c(&#39;Adverse&#39;,&#39;Adverse2&#39;))



plot &lt;- ggplot(data = AE_crosstab, mapping = aes(x = Adverse,
                                       y = Adverse2,
                                       fill = freq)) +
  geom_tile() +
  xlab(label = &quot;Adverse Event Name&quot;) +
  ylab(label = &quot;Adverse Event Name&quot;) +
  theme(axis.text.x = element_text(angle =90, vjust =0.5, hjust=1))


plot 
ggsave(&quot;Co-occurance heat map v1.png&quot;,width = 35, height = 20, units = &quot;cm&quot;)

#create function to sort within rows and make new var
f = function(x,y) {paste(sort(c(x, y)), collapse = &quot; - &quot;)}
f = Vectorize(f)


AE_crosstab &lt;- AE_crosstab %&gt;% mutate(dedup = f(Adverse, Adverse2))  %&gt;%
  distinct(dedup, .keep_all=TRUE) %&gt;%
  select(-dedup)

plot2 &lt;- ggplot(data = AE_crosstab, mapping = aes(x = Adverse,
                                                 y = Adverse2,
                                                 fill = freq)) +
  geom_tile() +
  xlab(label = &quot;Adverse Event Name&quot;) +
  ylab(label = &quot;Adverse Event Name&quot;) +
  theme_classic() +
  theme(axis.text.x = element_text(angle =90,size=12, vjust =0.5, hjust=1, face=&quot;bold&quot;), axis.text.y = element_text(size=14, face=&quot;bold&quot;))+
  theme(plot.title = element_text(size=22)) +
  theme(plot.subtitle = element_text(size=15)) +
  theme(axis.title=element_text(size=14,face=&quot;bold&quot;))

plot2

ggsave(&quot;Co-occurance heat map v2.png&quot;,width = 35, height = 20, units = &quot;cm&quot;)

######TRY GGCORRPLOT #############

AE_combined2 &lt;- AE_combined %&gt;% mutate(dedup = f(Adverse, Adverse2)) %&gt;%
  arrange(dedup,Time) %&gt;% 
  group_by(USUBJID) %&gt;%
  distinct(dedup, .keep_all=TRUE)%&gt;%
  ungroup() %&gt;%
  group_by(dedup) %&gt;%
  mutate(position=rank(Time,ties.method = &quot;first&quot;)) %&gt;%
  ungroup() %&gt;%
  rownames_to_column(&quot;Row&quot;)%&gt;%
  mutate(Row=as.integer(Row))

AE_combined3 &lt;- AE_combined %&gt;% mutate(dedup = f(Adverse, Adverse2)) %&gt;%
  arrange(dedup,Time) %&gt;% 
  group_by(USUBJID) %&gt;%
  distinct(dedup, .keep_all=TRUE)%&gt;%
  ungroup() %&gt;%
  group_by(dedup) %&gt;%
  dplyr::summarise(Median_time = median(Time), patients = n()) %&gt;%
  ungroup() 
 # %&gt;%
 # filter(dedup!=&quot;Nausea - Vomiting&quot;)


data_label &lt;- paste(&quot;n=&quot;,AE_combined3$patients,sep=&quot;&quot;)

plot5 &lt;- ggplot(data = AE_combined3, mapping = aes(x = dedup,
                                                  y = Median_time)) +
  geom_segment(aes(x=dedup, xend=dedup, y=0, yend=Median_time)) +
  geom_point(aes(size=patients), color=Darkblue, fill=ggplot2::alpha(Green, 0.3), alpha=0.7, shape=21, stroke=2) +
  scale_size_area(max_size = 15) +
  geom_text(aes(label=data_label),size=4, vjust=-2.5, fontface=&quot;bold&quot;) +
  ylim(0, 22)+
  labs(y= &quot;Median Overlap of Adverse Events (days)&quot;, x = &quot;Adverse Event Pairs&quot;, title=&quot;The median length of time that adverse events co-occur together&quot;, subtitle = &quot;Of all AE pairs, Nausea and Vomitting consistently co-occured with one another, but had a low median co-occurance (&lt; 5 days)&quot;) +
  theme_classic() +
  theme(legend.position = &quot;none&quot;, axis.text.x = element_text(angle =90,size=12, vjust =0.5, hjust=1, face=&quot;bold&quot;), axis.text.y = element_text(size=14, face=&quot;bold&quot;))+
  theme(plot.title = element_text(size=22)) +
  theme(plot.subtitle = element_text(size=15)) +
  theme(axis.title=element_text(size=14,face=&quot;bold&quot;))


plot5 

ggsave(&quot;Co-occurance v2.png&quot;,width = 35, height = 20, units = &quot;cm&quot;)

AE_combined4 &lt;- AE_combined3 %&gt;%
  group_by(patients) %&gt;%
  arrange(Median_time) %&gt;%
  rownames_to_column()

plot6 &lt;- ggplot(data = AE_combined4, mapping = aes(x = dedup,
                                                   y = Median_time)) +
  geom_segment(aes(x=reorder(dedup, rowname), xend=dedup, y=0, yend=Median_time)) +
  geom_point(aes(x=reorder(dedup, rowname), size=patients), color=Darkblue, fill=ggplot2::alpha(Green, 0.3), alpha=0.7, shape=21, stroke=2) +
  scale_size_area(max_size = 15) +
  geom_text(aes(x=reorder(dedup, rowname),label=data_label),size=4, vjust=-2.5, fontface=&quot;bold&quot;) +
  ylim(0, 22)+
  labs(y= &quot;Median Overlap of Adverse Events (days)&quot;, x = &quot;Adverse Event Pairs&quot;, title=&quot;The median length of time that adverse events co-occur together&quot;, subtitle = &quot;Of all AE pairs, Nausea and Vomitting consistently co-occured with one another, but had a low median co-occurance (&lt; 5 days)&quot;) +
  theme_classic() +
  theme(legend.position = &quot;none&quot;, axis.text.x = element_text(angle =90,size=12, vjust =0.5, hjust=1, face=&quot;bold&quot;), axis.text.y = element_text(size=14, face=&quot;bold&quot;))+
  theme(plot.title = element_text(size=22)) +
  theme(plot.subtitle = element_text(size=15)) +
  theme(axis.title=element_text(size=14,face=&quot;bold&quot;))</code></pre>
</div>
<p><a href="#example1">Back to blog</a></p>
<p><a id="example4 code"></a></p>
<h2 id="example-4.-upset-plot-1"><span style="color:red">Example 4. Upset Plot</span></h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
# packages
pacman::p_load(tidyverse, rio)
pacman::p_load(labelled)
# devtools::install_github(&quot;krassowski/complex-upset&quot;)
library(ComplexUpset)

# import &amp; recode ID &amp; sort
ae &lt;- import(&quot;https://raw.githubusercontent.com/VIS-SIG/Wonderful-Wednesdays/master/data/2020/2020-09-09/2020-09-09-fake-data_aes.csv&quot;) %&gt;% 
   mutate(id = str_remove(Subject,&quot;FAKE-DATA-&quot;) %&gt;% 
             as.numeric(), 
          .after = Subject) %&gt;% 
   arrange(id)

# 1 Duplicate
ae   %&gt;% filter(id == 10084) %&gt;% filter(`Adverse Event` == &quot;Diarrhea&quot;)

# Remove Duplicate
ae &lt;- ae %&gt;% 
   distinct()

# export fixed file
ae %&gt;% 
   export(&quot;C:/R/Wonderful-Wednesdays/2020-09-09/2020-09-09-fake-data_aes.csv.rds&quot;)

# extend to all days between adverse events
ae_l &lt;- ae %&gt;% 
   select(-Subject) %&gt;% 
   pivot_longer(cols = 2:3,
                values_to = &quot;day&quot;) %&gt;% 
   group_by(id, `Adverse Event`, `Treatment`, System, Severity, Sex ) %&gt;% 
   complete(day = seq(min(day), max(day), by = 1)) %&gt;% 
   select(-name) %&gt;% 
   ungroup() %&gt;% 
   arrange(id, day)

# Add variables to wide data
ae_w2 &lt;- ae_l %&gt;% 
   select(id, day, Sex, Treatment, Severity, `Adverse Event`) %&gt;%
   mutate(value = 1) %&gt;%
   pivot_wider(id_cols = c(&quot;id&quot;,&quot;day&quot;,&quot;Treatment&quot;,&quot;Sex&quot;),
               names_from = &quot;Adverse Event&quot;,
               values_from = &quot;value&quot;,
               values_fill  = 0) %&gt;% 
   mutate(Treatment = factor(Treatment, labels = c(&quot;A&quot;,&quot;B&quot;)))
# You cannot do the analysis using severity because at each day there can be diverse severerities for
# different AE&#39;s overalapping

# Figure 2.1
upset(
   data = ae_w2,
   intersect = names(ae_w2)[-c(1:4)],
   min_size = 20,
   width_ratio = 0.25,
   height_ratio = 1,
   name  = NULL,
   queries=list(
      upset_query(
         intersect=c(&quot;Nausea&quot;,&quot;Vomiting&quot;),
         color=  &quot;#E41A1C&quot;,
         fill  =  &quot;#E41A1C&quot;,
         
         only_components=c(&#39;intersections_matrix&#39;, &#39;Intersection size&#39;)
      )
   ),
   annotations = list(
      &#39;Intersection Size\n(Treatment %)&#39; = list(
         aes = aes(x=intersection, fill=Treatment ),
         geom = list(
            geom_bar(stat=&#39;count&#39;, position=&#39;fill&#39;),
            geom_hline(yintercept = 0.5, col=&#39;gray90&#39;),
            scale_y_continuous(labels=scales::percent_format()),
            scale_fill_brewer(palette = &quot;Dark2&quot;)
         )
      ),
      &#39;Intersection Size\n(Sex %)&#39; = list(
         aes = aes(x=intersection, fill=Sex),
         geom = list(
            geom_bar(stat=&#39;count&#39;, position=&#39;fill&#39;),
            geom_hline(yintercept = 0.5, col=&#39;gray90&#39;),
            scale_y_continuous(labels=scales::percent_format()),
            scale_fill_manual(values = c(&quot;#E78AC3&quot;,&quot;#8DA0CB&quot;))
         )
      )
   ),
   themes=upset_modify_themes(
      list(&#39;overall_sizes&#39;= theme(axis.ticks.x = element_line()))
   )
) +
   labs(title = &#39;Co-Occurence of Daily AE Symptoms&#39;,
        caption = &#39;Symptoms with more than 20 days by Frequency: Total pool is 148 individuals for 2575 Daily AE Symptoms \n Lex, Alexander, et al. &quot;UpSet: visualization of intersecting sets.&quot; IEEE transactions on visualization and computer graphics 20.12 (2014): 1983-1992.&#39;) +
   ggsave(&quot;C:/R/Wonderful-Wednesdays/2020-09-09/UpSet_plot.png&quot;,
          width = 11, height =10, units = &quot;in&quot;)</code></pre>
</div>
<p><a href="#example4">Back to blog</a></p>
<p><a id="example5 code"></a></p>
<h2 id="example-5.-adepro-1"><span style="color:red">Example 5. ADEPRO</span></h2>
<div class="layout-chunk" data-layout="l-body">
<pre class="r"><code>
##########################################################################################
## AdEPro for Wonderful Wednesday Webinar                                               ##
## Main purpose of this program: Restructure the example dataset to read it into AdEPro ##
##########################################################################################

# setwd(&quot;&quot;) # insert link to working directory

# read dataset and attribute column names
dat &lt;- read.csv(&quot;2020-09-09-fake-data_aes.csv&quot;, sep=&quot;;&quot;, header=TRUE)
colnames(dat) &lt;- c(&quot;SUBJID&quot;, &quot;AESTDY&quot;, &quot;AEENDY&quot;, &quot;AEDECOD&quot;, &quot;TRT01A&quot;, &quot;SOC&quot;, &quot;AESEV&quot;, &quot;SEX&quot;)

n &lt;- nrow(dat) # number of rows in dataset

## AE intensity must be numeric/integer and missing intensities are imputed with Moderate (2)
AESEVN &lt;- as.integer(dat$AESEV); AESEVN[is.na(AESEVN)] &lt;- 2

# Subject ID is not unique per treatment group, therefore the Subject ID receives a leading one for treatment A,
# and a leading 2 for treatment B, and only the numeric part of the original name is kept
TRT &lt;- as.numeric(dat$TRT01A)
SJ &lt;- substr(dat$SUBJID, 11, 15)
SUBJIDN &lt;- as.integer(sapply(1:n, function(x) as.numeric(paste(TRT[x],SJ[x],sep=&quot;&quot;))))

# other required variables for AdEPro are added: safety analysis set flag (assumed as Yes), death date (always missing),
# last visit date (date of overall last AE end date for all patients), treatment start date (set to 1 for all patients),
# treatment-emergent, serious and study drug related flag (always assumed as Yes)
dat.rest &lt;- data.frame(SAFFN=as.integer(rep(1,n)), DTHDT=as.factor(rep(&quot;.&quot;,n)), LVDT=rep(max(dat$AEENDY),n), 
                       TRTSDT=as.integer(rep(1,n)),
                       SUBJIDN=SUBJIDN, AETRTEMN=as.integer(rep(1,n)), AESEVN=AESEVN, 
                       AESERN=as.integer(rep(1,n)), AERELN=as.integer(rep(1,n)))

# merge all together and write out AE dataset
dat_all &lt;- cbind(dat, dat.rest)[,c(13,4,2,3,15,14,5,12,11,10,8,9,1,16,17)]
write.csv(dat_all, file=&quot;2020-09-09-fake-data_aes_modified.csv&quot;, row.names=FALSE, na=&quot;.&quot;)
# the generated dataset should be used under &quot;Upload Adverse Event data&quot; after starting the adepro app


# create additional subject level dataset to get all combinations of subject ID and treatment group 

subjects &lt;- sort(unique(SJ)); N &lt;- length(subjects) # all unique subjects
subjects_trt &lt;- c(paste(1,subjects,sep=&quot;&quot;),paste(2,subjects,sep=&quot;&quot;)) # all combinations subjects - treatment
subjects2 &lt;- rep(paste(&quot;FAKE-DATA-&quot;,subjects,sep=&quot;&quot;),2)

# get all AE data to merge with subject-treatment combinations
dat_all_sub &lt;- unique(dat_all[,c(8:13)])
dat_sj0 &lt;- data.frame(SUBJIDN=subjects_trt, SUBJID=subjects2,
                      TRT01A=rep(c(&quot;Treatment A&quot;, &quot;Treatment B&quot;), each=N))
dat_sj &lt;- merge(dat_sj0, dat_all_sub, by = &quot;SUBJID&quot;)

write.csv(dat_sj, file=&quot;2020-09-09-fake-data_subjects.csv&quot;, row.names=FALSE, na=&quot;.&quot;)
# the generated dataset should be used under &quot;Upload Subject Level data&quot; after starting the adepro app


# Load AdEPro
library(adepro)
launch_adepro() # launches the adepro app
# after the page is loaded, one can upload the adverse event and subject level dataset in the &quot;Upload data&quot; panel</code></pre>
</div>
<p><a href="#example5">Back to blog</a></p>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
