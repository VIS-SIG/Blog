<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #545454; font-weight: bold; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #a1024a; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007faa; font-weight: bold; } /* ControlFlow */
code span.ch { color: #008000; } /* Char */
code span.cn { color: #d91e18; } /* Constant */
code span.co { color: #545454; } /* Comment */
code span.cv { color: #545454; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #aa5d00; } /* DataType */
code span.dv { color: #a1024a; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #a1024a; } /* Float */
code span.fu { color: #4254a7; } /* Function */
code span.im { } /* Import */
code span.in { color: #545454; font-weight: bold; } /* Information */
code span.kw { color: #007faa; font-weight: bold; } /* Keyword */
code span.op { color: #696969; } /* Operator */
code span.ot { color: #007faa; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #008000; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #008000; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #008000; } /* VerbatimString */
code span.wa { color: #545454; font-weight: bold; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Wonderful Wednesday April 2020</title>
  
  <meta property="description" itemprop="description" content="In this webinar we discuss the first submissions looking at some great ways to visualise a categorical response variable over time. We talk about what the SIG members like about each plot and give some pointers on areas we think could be improved. More specifically, we talk about: the value of a title with conclusions, the use of colour, the benefits of animation to display time, ways to declutter your graph and examples of clean design, enclosure to highlight important parts of the data, the benefits of the sankey diagram, how different charts help to answer different questions, and many more aspects of great visualizations."/>
  
  
  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2020-04-09"/>
  <meta property="article:created" itemprop="dateCreated" content="2020-04-09"/>
  <meta name="article:author" content="Rachel Phillips, Steve Mallett"/>
  
  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Wonderful Wednesday April 2020"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="In this webinar we discuss the first submissions looking at some great ways to visualise a categorical response variable over time. We talk about what the SIG members like about each plot and give some pointers on areas we think could be improved. More specifically, we talk about: the value of a title with conclusions, the use of colour, the benefits of animation to display time, ways to declutter your graph and examples of clean design, enclosure to highlight important parts of the data, the benefits of the sankey diagram, how different charts help to answer different questions, and many more aspects of great visualizations."/>
  <meta property="og:image" content="https://vis-sig.github.io/blog/plots/plot01.png"/>
  <meta property="og:image:width" content="5790"/>
  <meta property="og:image:height" content="2700"/>
  <meta property="og:locale" content="en_US"/>
  
  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary_large_image"/>
  <meta property="twitter:title" content="Wonderful Wednesday April 2020"/>
  <meta property="twitter:description" content="In this webinar we discuss the first submissions looking at some great ways to visualise a categorical response variable over time. We talk about what the SIG members like about each plot and give some pointers on areas we think could be improved. More specifically, we talk about: the value of a title with conclusions, the use of colour, the benefits of animation to display time, ways to declutter your graph and examples of clean design, enclosure to highlight important parts of the data, the benefits of the sankey diagram, how different charts help to answer different questions, and many more aspects of great visualizations."/>
  <meta property="twitter:image" content="https://vis-sig.github.io/blog/plots/plot01.png"/>
  <meta property="twitter:image:width" content="5790"/>
  <meta property="twitter:image:height" content="2700"/>
  
  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","base_url","preview","output"]}},"value":[{"type":"character","attributes":{},"value":["Wonderful Wednesday April 2020"]},{"type":"character","attributes":{},"value":["In this webinar we discuss the first submissions looking at some great ways to visualise a categorical response variable over time. We talk about what the SIG members like about each plot and give some pointers on areas we think could be improved. More specifically, we talk about: the value of a title with conclusions, the use of colour, the benefits of animation to display time, ways to declutter your graph and examples of clean design, enclosure to highlight important parts of the data, the benefits of the sankey diagram, how different charts help to answer different questions, and many more aspects of great visualizations.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Rachel Phillips, Steve Mallett"]},{"type":"character","attributes":{},"value":["https://www.psiweb.org/sigs-special-interest-groups/visualisation"]}]}]},{"type":"character","attributes":{},"value":["04-09-2020"]},{"type":"character","attributes":{},"value":["survival data","Kaplan-Meier","Wonderful Wednesdays"]},{"type":"character","attributes":{},"value":["https://vis-sig.github.io/blog"]},{"type":"character","attributes":{},"value":["plots/plot01.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["code/2020-04-08-markusv_area.R","code/2020-04-08-markusv_km.R","code/km-plot - Mark Baillie.R","code/PSI_April_Heat_map_v1_0/PSI_April_Heat_map_v1_0.html","code/PSI_April_Heat_map_v1_0/PSI_April_Heat_map_v1_0.R","code/PSI_April_Heat_map_v1_0/README(HeatMap-Lan Meier).txt","code/PSI_April_KM_v1_0_local/app.R","code/PSI_April_KM_v1_0_local/Interactive Kaplan-Meier Plot.lnk","code/PSI_April_KM_v1_0_local/PSI_April_KM_demo.mp4","code/PSI_April_KM_v1_0_local/README(Interactive Kaplan Meier).txt","code/PSI_KM_2020_05_04 - manz352.sas","Octocat.jpg","plots/plot01.png","plots/plot02.png","plots/plot03.PNG","plots/plot04.PNG","plots/plot05.PNG","plots/plot06.png","wonderful-wednesday-april-2020_files/bowser-1.9.3/bowser.min.js","wonderful-wednesday-april-2020_files/distill-2.2.21/template.v2.js","wonderful-wednesday-april-2020_files/jquery-1.11.3/jquery.min.js","wonderful-wednesday-april-2020_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->
  
  <style type="text/css">
  
  body {
    background-color: white;
  }
  
  .pandoc-table {
    width: 100%;
  }
  
  .pandoc-table>caption {
    margin-bottom: 10px;
  }
  
  .pandoc-table th:not([align]) {
    text-align: left;
  }
  
  .pagedtable-footer {
    font-size: 15px;
  }
  
  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }
  
  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }
  
  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }
  
  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }
  
  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }
  
  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }
  
  .html-widget {
    margin-bottom: 2.0em;
  }
  
  .l-screen-inset {
    padding-right: 16px;
  }
  
  .l-screen .caption {
    margin-left: 10px;
  }
  
  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .shaded .shaded-content {
    background: white;
  }
  
  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }
  
  .hidden {
    display: none !important;
  }
  
  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }
  
  d-appendix {
    padding-top: 30px;
  }
  
  d-article>p>img {
    width: 100%;
  }
  
  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }
  
  d-article h3 {
    margin-top: 1.5rem;
  }
  
  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }
  
  /* Tweak code blocks */
  
  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: hidden;
  }
  
  d-article div.sourceCode {
    background-color: white;
  }
  
  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }
  
  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  d-article pre a {
    border-bottom: none;
  }
  
  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }
  
  @media(min-width: 768px) {
  
  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }
  
  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }
  
  d-article pre {
    font-size: 14px;
  }
  
  }
  
  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  /* CSS for d-contents */
  
  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }
  
  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }
  
  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }
  
  .d-contents li {
    list-style-type: none
  }
  
  .d-contents nav > ul {
    padding-left: 0;
  }
  
  .d-contents ul {
    padding-left: 1em
  }
  
  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }
  
  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }
  
  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }
  
  .d-contents nav > ul > li > a {
    font-weight: 600;
  }
  
  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }
  
  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }
  
  
  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }
  
  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }
  
  
  /* Figure */
  
  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }
  
  .figure img {
    width: 100%;
  }
  
  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }
  
  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }
  
  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }
  
  /* Citations */
  
  d-article .citation {
    color: inherit;
    cursor: inherit;
  }
  
  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }
  
  
  /* Tweak 1000px media break to show more text */
  
  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }
  
    .grid {
      grid-column-gap: 16px;
    }
  
    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }
  
  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }
  
    .grid {
      grid-column-gap: 32px;
    }
  }
  
  
  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */
  
  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  /* Include appendix styles here so they can be overridden */
  
  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }
  
  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }
  
  d-appendix h3 + * {
    margin-top: 1em;
  }
  
  d-appendix ol {
    padding: 0 0 0 15px;
  }
  
  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }
  
  d-appendix li {
    margin-bottom: 1em;
  }
  
  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }
  
  d-appendix > * {
    grid-column: text;
  }
  
  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }
  
  /* Include footnote styles here so they can be overridden */
  
  d-footnote-list {
    contain: layout style;
  }
  
  d-footnote-list > * {
    grid-column: text;
  }
  
  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }
  
  
  
  /* Anchor.js */
  
  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }
  
  /* Social footer */
  
  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }
  
  .disqus-comments {
    margin-right: 30px;
  }
  
  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }
  
  #disqus_thread {
    margin-top: 30px;
  }
  
  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }
  
  .article-sharing a:hover {
    border-bottom: none;
  }
  
  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .subscribe p {
    margin-bottom: 0.5em;
  }
  
  
  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }
  
  
  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }
  
  .custom p {
    margin-bottom: 0.5em;
  }
  
  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }
  
  /* Styles for posts lists (not auto-injected) */
  
  
  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }
  
  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }
  
  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }
  
  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }
  
  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }
  
  .post-preview-last {
    border-bottom: none !important;
  }
  
  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }
  
  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }
  
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }
  
  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }
  
  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }
  
  .posts-list .metadata > * {
    display: inline-block;
  }
  
  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }
  
  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }
  
  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }
  
  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }
  
  .posts-list img {
    opacity: 1;
  }
  
  .posts-list img[data-src] {
    opacity: 0;
  }
  
  .posts-more {
    clear: both;
  }
  
  
  .posts-sidebar {
    font-size: 16px;
  }
  
  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }
  
  .sidebar-section {
    margin-bottom: 30px;
  }
  
  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
  
  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }
  
  .categories li>a {
    border-bottom: none;
  }
  
  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }
  
  .categories .active {
    font-weight: 600;
  }
  
  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }
  
  
  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }
  
  
  /* Improve display for browsers without grid (IE/Edge <= 15) */
  
  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }
  
  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }
  
  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }
  
  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }
  
  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }
  
  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }
  
  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }
  
  
  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }
  
  .downlevel .footnotes ol {
    padding-left: 13px;
  }
  
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }
  
  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }
  
  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }
  
  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;
  
    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;
  
    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }
  
  .downlevel .posts-list .post-preview {
    color: inherit;
  }
  
  
  
  </style>
  
  <script type="application/javascript">
  
  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }
  
  // show body when load is complete
  function on_load_complete() {
  
    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }
  
  
    // set body to visible
    document.body.style.visibility = 'visible';
  
    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }
  
    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }
  
  function init_distill() {
  
    init_common();
  
    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);
  
    // create d-title
    $('.d-title').changeElementType('d-title');
  
    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);
  
    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();
  
    // move posts container into article
    $('.posts-container').appendTo($('d-article'));
  
    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');
  
    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;
  
    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();
  
    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));
  
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });
  
    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');
  
    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {
  
      // capture layout
      var layout = $(this).attr('data-layout');
  
      // apply layout to markdown level block elements
      var elements = $(this).children().not('div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });
  
  
      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });
  
    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();
  
    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();
  
    // load distill framework
    load_distill_framework();
  
    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {
  
      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;
  
      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');
  
      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');
  
      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');
  
      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });
  
      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }
  
      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');
  
      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");
  
      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }
  
       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }
  
      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();
  
      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();
  
      // clear polling timer
      clearInterval(tid);
  
      // show body now that everything is ready
      on_load_complete();
    }
  
    var tid = setInterval(distill_post_process, 50);
    distill_post_process();
  
  }
  
  function init_downlevel() {
  
    init_common();
  
     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));
  
    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
  
    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();
  
    // remove toc
    $('.d-contents').remove();
  
    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });
  
  
    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);
  
    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);
  
    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();
  
    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();
  
    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));
  
    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });
  
    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));
  
    $('body').addClass('downlevel');
  
    on_load_complete();
  }
  
  
  function init_common() {
  
    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};
  
        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });
  
        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);
  
    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});
  
    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });
  
      }
    });
  
    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });
  
    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }
  
    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');
  
    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");
  
    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();
  
    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }
  
  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });
  
  </script>
  
  <!--/radix_placeholder_distill-->
  <script src="wonderful-wednesday-april-2020_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="wonderful-wednesday-april-2020_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="wonderful-wednesday-april-2020_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="wonderful-wednesday-april-2020_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="wonderful-wednesday-april-2020_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Wonderful Wednesday April 2020","description":"In this webinar we discuss the first submissions looking at some great ways to visualise a categorical response variable over time. We talk about what the SIG members like about each plot and give some pointers on areas we think could be improved. More specifically, we talk about: the value of a title with conclusions, the use of colour, the benefits of animation to display time, ways to declutter your graph and examples of clean design, enclosure to highlight important parts of the data, the benefits of the sankey diagram, how different charts help to answer different questions, and many more aspects of great visualizations.","authors":[{"author":"Rachel Phillips, Steve Mallett","authorURL":"https://www.psiweb.org/sigs-special-interest-groups/visualisation","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2020-04-09T00:00:00.000+02:00","citationText":"Mallett, 2020"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Wonderful Wednesday April 2020</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">survival data</div>
<div class="dt=tag">Kaplan-Meier</div>
<div class="dt=tag">Wonderful Wednesdays</div>
</div>
<!--/radix_placeholder_categories-->
<p>In this webinar we discuss the first submissions looking at some great ways to visualise a categorical response variable over time. We talk about what the SIG members like about each plot and give some pointers on areas we think could be improved. More specifically, we talk about: the value of a title with conclusions, the use of colour, the benefits of animation to display time, ways to declutter your graph and examples of clean design, enclosure to highlight important parts of the data, the benefits of the sankey diagram, how different charts help to answer different questions, and many more aspects of great visualizations.</p>
</div>

<div class="d-byline">
  Rachel Phillips, Steve Mallett <a href="https://www.psiweb.org/sigs-special-interest-groups/visualisation" class="uri">https://www.psiweb.org/sigs-special-interest-groups/visualisation</a> 
  
<br/>04-09-2020
</div>

<div class="d-article">
<p>This month’s challenge involved a classic survival dataset example. You can download the dataset <a href="https://github.com/VIS-SIG/Wonderful-Wednesdays/tree/master/data/2020/2020-04-08">here</a>. This simulated example dataset was based on a phase III clinical trial in breast cancer, you can read more about this study <a href="https://ascopubs.org/doi/pdf/10.1200/JCO.2015.62.1797">here</a>. To summarise, this was a four-arm study, where participants were randomised to receive either one of two monotherapies or one of two combination therapies for 1 year with 4 years post treatment follow-up. The primary outcome was progression free survival and we wanted you to explore different ways of visualising this time-to-event outcome. The dataset contained information that allowed you to explore subgroups, patterns of events and individual patient profiles. More information on the dataset is available <a href="https://github.com/VIS-SIG/Wonderful-Wednesdays/tree/master/data/2020/2020-04-08">here</a>.</p>
<p>We received a variety of submissions in this round including both static and interactive plots and we would like to thank everyone for their contributions. In the webinar members of the VIS SIG discussed the merits of each and picked out key elements they felt would make the ‘ultimate plot’. We summarise the discussions for each submission below.</p>
<p><a id="example1"></a></p>
<h1 id="example-1">Example 1</h1>
<figure>
<img src="plots/plot01.png" title="Plot 1" alt="Plot 1" /><figcaption>Plot 1</figcaption>
</figure>
<p><a href="#example1%20code">link to code</a><br />
<a href="./plots/plot01.png" title="Plot 1">high-resolution image</a></p>
<p>On the left this plot displays the proportion of participants that are event free over time by treatment arm and on the right we can see the cumulative number of events over time by treatment arm. Inclusion of both of these figures into one image gives a view of the data which we don’t often see. Inclusion of uncertainty is also not often seen in Kaplan-Meier plots (but has been advocated in this recent publication from <a href="https://bmjopen.bmj.com/content/9/9/e030215">Morris et al.</a>) but is extremely useful and the clutter from the overlap of the confidence bands is perhaps less problematic with inclusion of the cumulative plot on the right. The team liked the inclusion of the tables of numbers at risk and the cumulative number of events at the bottom of each plot, this is important information, and we felt this approach didn’t overload or create a cluttered image. We thought there was a nice use of colour.</p>
<p>Whilst there is clear labelling of the axis and the inclusion of a common legend ensures clarity this image would benefit from inclusion of some extra details to allow it to stand-alone, for example it would benefit from inclusion of a title. In terms of creating a clearer image we also felt that the dashes to indicate censoring in the image on the left could be omitted given the information on numbers at risk are available at the bottom of the plot.</p>
<p>This is a nice example of an exploratory type plot that statisticians can use to understand the data but if the aim is to communicate a message to stakeholders then we would suggest presenting less information in a simpler graphic.</p>
<p><a id="example2"></a></p>
<h1 id="example-2">Example 2</h1>
<figure>
<img src="plots/plot02.png" title="Plot 2" alt="Plot 2" /><figcaption>Plot 2</figcaption>
</figure>
<p><a href="#example2%20code">link to code</a><br />
<a href="./plots/plot02.png" title="Plot 2">high-resolution image</a></p>
<p>This presentation of the data displays the cumulative proportion of participants experiencing an event. It includes a separate plot for each treatment arm and the inclusion of subtitles ensures clarity. This plot is being used to tell a story, which the title guides us towards. Inclusion of a reference line at an important time point is helpful to guide the audience’s attention. Labelling the x and y-axis only once prevents clutter and in combination with the inclusion of the reference lines makes this a clear presentation of the data. This demonstrates an effective use of graduation of saturation and clear annotation.</p>
<p>The team noted that there are six colours of grey in the legend but that it was difficult to pick out all six groups in the image. This was because one of the groups is very small. However, it’s tricky to pick out which group this is so we caution potential users to be mindful of this in their own plots.</p>
<p>This is an original, well thought through presentation of survival data which we commend and think would work well where the is a natural ordering of the groups.</p>
<p><a id="example3"></a></p>
<h1 id="example-3">Example 3</h1>
<figure>
<img src="plots/plot03.PNG" title="Plot 3" alt="Plot 3" /><figcaption>Plot 3</figcaption>
</figure>
<p><a href="#example3%20code">link to code</a><br />
<a href="./plots/plot03.PNG" title="Plot 3">high-resolution image</a></p>
<p>This is a very nice, interactive visual presentation of a growing or developing Kaplan-Meier plot link. This image included some really nice design points that update as the image progresses that can help to tell a story. These included:</p>
<ul>
<li>The percentages on right y-axis changing as the video plays,</li>
<li>The inclusion of an additional x-axis at the top of the plot that is populated as it progresses,</li>
<li>The developing reference lines that follow the data as the plot progresses.</li>
</ul>
<p>The team felt that this interactive approach could help understanding and interpretation amongst those not so familiar with Kaplan-Meier plots. It’s a potentially useful way to force the viewer to take the entire time period into consideration and not just the final time point when there is often the most uncertainty.</p>
<p>With some additional information on the right y-axis such as estimates of treatment effects this could be a really powerful design choice. A minor point was that it would be nice to include treatment labels with the numbers on the right y-axis so the audience do not have to keep referring back to the legend as the image progresses.</p>
<p><a id="example4"></a></p>
<h1 id="example-4">Example 4</h1>
<figure>
<img src="plots/plot04.PNG" title="Plot 4" alt="Plot 4" /><figcaption>Plot 4</figcaption>
</figure>
<p><a href="#example4%20code">link to code</a><br />
<a href="./plots/plot04.PNG" title="Plot 4">high-resolution image</a></p>
<p>This is a very flexible tool to display Kaplan-Meier plots that explores the subgroup element of the challenge link. It allows the user to change what is presented e.g. displaying information on different treatment groups, different subgroups, or restricting information presented by the age range of participants. Including the legend within the plot and use of grid lines both help audiences to interpret this image.</p>
<p>This is a nice way to present the data for exploratory purposes. It would be nice to include sample sizes and confidence intervals within this tool to represent the uncertainty and minimise the risk of making incorrect conclusions.</p>
<p><a id="example5"></a></p>
<h1 id="example-5">Example 5</h1>
<figure>
<img src="plots/plot05.PNG" title="Plot 5" alt="Plot 5" /><figcaption>Plot 5</figcaption>
</figure>
<p><a href="#example5%20code">link to code</a><br />
<a href="./code/PSI_April_Heat_map_v1_0/PSI_April_Heat_map_v1_0.html">link to html file</a><br />
<a href="./plots/plot05.PNG" title="Plot 5">high-resolution image</a></p>
<p>The use of a heat map to present survival data is a new idea to the group. At first some of us found it difficult to understand but with some thought it definitely becomes clearer. Given the novelty of this plot it probably needs more information to explain what is going on but could be very useful to help deliver a message to audiences. Inclusion of a clear message in the title and the ordering of the data in a way that the image portrays this really helps i.e. the white stripe representing the median helps show differences between treatment arms.</p>
<p>As well as a ‘big picture’ message from the changes in colour there is also an interactive element to this plot allowing more detailed information to be provided, as the user hovers over different points on the plot information on the survival function at that time point is displayed. Similarly hovering over the reference lines displays further information.</p>
<p><a id="example6"></a></p>
<h1 id="example-6">Example 6</h1>
<figure>
<img src="plots/plot06.png" title="Plot 6" alt="Plot 6" /><figcaption>Plot 6</figcaption>
</figure>
<p><a href="#example6%20code">link to code</a><br />
<a href="./plots/plot06.png" title="Plot 6">high-resolution image</a></p>
<p>This image displays a Kaplan-Meier plot for each treatment arm with accompanying confidence bands with inclusion of other treatment arms in grey for comparison. This is simple, clear plot exhibiting use of good data visualisation principles. We liked the clear message in the title, inclusion of numbers at risk for each plot rather than in a table and the use of grid lines. The team felt that this plot would be good for communicating a message.</p>
<p>Minor adjustments we recommend are: including a more prominent grid line at 52 weeks, including a legend clearly explaining what the red line and reference bands are and changing the scale from days to weeks or months.</p>
<h1 id="code">Code</h1>
<p><a id="example1 code"></a></p>
<h2 id="example-1-r">Example 1 (R)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>### Purpose: create TTE KM plots</span>

<span class='co'>### Load packages</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://readr.tidyverse.org'>readr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>survminer</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://stringr.tidyverse.org'>stringr</a></span><span class='op'>)</span>

<span class='co'>### Load data</span>
<span class='fu'><a href='https://rdrr.io/r/base/getwd.html'>setwd</a></span><span class='op'>(</span><span class='st'>'C:/Users/XXXXXXXXXXXXX'</span><span class='op'>)</span>
<span class='va'>ADTTE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_delim</a></span><span class='op'>(</span><span class='st'>'2020-04-08-psi-vissig-adtte.csv'</span>, delim<span class='op'>=</span><span class='st'>';'</span><span class='op'>)</span>

<span class='co'>### AVAL is given in days; transform into weeks</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AVAL_wk</span> <span class='op'>=</span> <span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AVAL</span> <span class='op'>/</span> <span class='fl'>7</span>

<span class='co'>### Create survival curves</span>
<span class='va'>surv_curve</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL_wk</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>ADTTE</span><span class='op'>)</span>

<span class='co'>### Adjust treatment group labels in surv_curve</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>surv_curve</span><span class='op'>$</span><span class='va'>strata</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>surv_curve</span><span class='op'>$</span><span class='va'>strata</span><span class='op'>)</span>, <span class='st'>"TRT01P="</span><span class='op'>)</span> 

<span class='co'>### Theme for plots</span>
<span class='va'>theme_table</span> <span class='op'>&lt;-</span> <span class='fu'>theme_minimal</span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span> <span class='op'>%+replace%</span> 
  <span class='fu'>theme</span><span class='op'>(</span>panel.grid.major.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>, panel.grid.minor.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,  <span class='co'># remove vertical gridlines</span>
        panel.grid.major.y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,  <span class='co'># remove horizontal gridlines</span>
        axis.title.y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>, axis.title.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,  <span class='co'># remove axis titles</span>
        axis.text.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>, axis.ticks.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># remove x-axis text and ticks</span>

<span class='va'>theme_gg</span> <span class='op'>&lt;-</span> <span class='fu'>theme_minimal</span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span> <span class='op'>%+replace%</span> 
  <span class='fu'>theme</span><span class='op'>(</span>panel.grid.minor.y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>, panel.grid.minor.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,  <span class='co'># remove minor gridlines</span>
        legend.title <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># remove legend title</span>

<span class='co'>### Plot </span>
<span class='va'>plots</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='co'># Proportion event-free</span>
<span class='va'>plots</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>ggsurvplot</span><span class='op'>(</span>fit <span class='op'>=</span> <span class='va'>surv_curve</span>,  <span class='co'># survfit object</span>
                         data <span class='op'>=</span> <span class='va'>ADTTE</span>,  <span class='co'># data used to fit survival curves. </span>
                         break.y.by <span class='op'>=</span> <span class='fl'>0.2</span>,  <span class='co'># y-axis breaks</span>
                         risk.table <span class='op'>=</span> <span class='cn'>T</span>,  <span class='co'># show risk table.</span>
                         conf.int <span class='op'>=</span> <span class='cn'>T</span>,  <span class='co'># show confidence intervals</span>
                         xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>160</span><span class='op'>)</span>,  <span class='co'># present narrower X axis</span>
                         break.time.by <span class='op'>=</span> <span class='fl'>20</span>,  <span class='co'># x-axis breaks</span>
                         ggtheme <span class='op'>=</span> <span class='va'>theme_gg</span>,  <span class='co'># use theme defined above</span>
                         risk.table.y.text <span class='op'>=</span> <span class='cn'>F</span>, <span class='co'># show bars instead of names in text annotations in legend of risk table</span>
                         xlab <span class='op'>=</span> <span class='st'>"Week"</span>,
                         ylab <span class='op'>=</span> <span class='st'>"Proportion event-free"</span>,
                         legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.7</span>, <span class='fl'>0.15</span><span class='op'>)</span>,  <span class='co'># legend position</span>
                         tables.theme <span class='op'>=</span> <span class='va'>theme_table</span><span class='op'>)</span>  <span class='co'># use them defined above for risk table</span>

<span class='co'># Cumulative proportion with event</span>
<span class='va'>plots</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>ggsurvplot</span><span class='op'>(</span>fit <span class='op'>=</span> <span class='va'>surv_curve</span>,
                         data <span class='op'>=</span> <span class='va'>ADTTE</span>,
                         fun <span class='op'>=</span> <span class='st'>"event"</span>,  <span class='co'># show event probability instead of survival probability</span>
                         ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.6</span><span class='op'>)</span>,  <span class='co'># do not include full scale (0-1) to allow to better discriminate between treatments</span>
                         break.y.by <span class='op'>=</span> <span class='fl'>0.1</span>,
                         cumevents <span class='op'>=</span> <span class='cn'>T</span>,  <span class='co'># show cumulative number of events</span>
                         conf.int <span class='op'>=</span> <span class='cn'>F</span>,
                         xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>160</span><span class='op'>)</span>,
                         break.time.by <span class='op'>=</span> <span class='fl'>20</span>,
                         ggtheme <span class='op'>=</span> <span class='va'>theme_gg</span>,
                         cumevents.y.text <span class='op'>=</span> <span class='cn'>FALSE</span>,
                         xlab <span class='op'>=</span> <span class='st'>"Week"</span>,
                         ylab <span class='op'>=</span> <span class='st'>"Cumulative proportion with event"</span>,
                         legend <span class='op'>=</span> <span class='st'>"none"</span>,
                         tables.theme <span class='op'>=</span> <span class='va'>theme_table</span><span class='op'>)</span>

<span class='co'># Save plot</span>
<span class='fu'>ggsave</span><span class='op'>(</span>filename <span class='op'>=</span> <span class='st'>"2020-04-08-markusv_km.png"</span>,
       plot <span class='op'>=</span> <span class='fu'>arrange_ggsurvplots</span><span class='op'>(</span><span class='va'>plots</span>, print <span class='op'>=</span> <span class='cn'>T</span>, ncol <span class='op'>=</span> <span class='fl'>2</span>, nrow <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
       width <span class='op'>=</span> <span class='fl'>19.3</span>, height <span class='op'>=</span> <span class='fl'>9</span>, units <span class='op'>=</span> <span class='st'>"in"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><a href="#example1">Back to blog</a></p>
<p><a id="example2 code"></a></p>
<h2 id="example-2-r">Example 2 (R)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>### Purpose: create TTE area plot</span>

<span class='co'>### Load packages</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://readr.tidyverse.org'>readr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://zoo.R-Forge.R-project.org/'>zoo</a></span><span class='op'>)</span>

<span class='co'>### Load data</span>
<span class='fu'><a href='https://rdrr.io/r/base/getwd.html'>setwd</a></span><span class='op'>(</span><span class='st'>'C:/Users/XXXXXXX'</span><span class='op'>)</span>
<span class='va'>ADTTE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_delim</a></span><span class='op'>(</span><span class='st'>'2020-04-08-psi-vissig-adtte.csv'</span>, delim<span class='op'>=</span><span class='st'>';'</span><span class='op'>)</span>

<span class='co'>### AVAL is given in days; transform into weeks</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AVAL_wk</span> <span class='op'>=</span> <span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AVAL</span> <span class='op'>/</span> <span class='fl'>7</span>

<span class='co'>### Derive number of subjects per treatment group</span>
<span class='va'>ADTTE_ntrt</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>TRT01PN</span>, <span class='va'>TRT01P</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>N<span class='op'>=</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>### Derive cumulative number (percentage) of subjects with event / censoring</span>
<span class='va'>ADTTE_cum</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE_ntrt</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>TRT01PN</span>, <span class='va'>TRT01P</span>, <span class='va'>N</span>, <span class='va'>EVNTDESC</span>, <span class='va'>AVAL_wk</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, pct <span class='op'>=</span> <span class='va'>n</span> <span class='op'>/</span> <span class='va'>N</span><span class='op'>)</span>

<span class='co'>### Create grid to ensure all groups have a value at each timepoint (necessary for geom_area())</span>
<span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>ADTTE_cum</span>, <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>TRT01PN <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>TRT01PN</span><span class='op'>)</span>, EVNTDESC <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>EVNTDESC</span><span class='op'>)</span>, 
                                    AVAL_wk <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>AVAL_wk</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>ADTTE_grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/merge.html'>merge</a></span><span class='op'>(</span><span class='va'>grid</span>, <span class='va'>ADTTE_cum</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TRT01PN"</span>, <span class='st'>"EVNTDESC"</span>, <span class='st'>"AVAL_wk"</span><span class='op'>)</span>, all <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>

<span class='co'>### Fill in NA values with last non-NA value and remove leading NA rows</span>
<span class='va'>ADTTE_locf</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE_grid</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>TRT01PN</span>, <span class='va'>EVNTDESC</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/do.html'>do</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/zoo/man/na.locf.html'>na.locf</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>### Control order (show events at bottom and censoring above)</span>
<span class='va'>ADTTE_locf</span><span class='op'>$</span><span class='va'>EVNTDESC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>ADTTE_locf</span><span class='op'>$</span><span class='va'>EVNTDESC</span>, levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Lost to follow-up"</span>, <span class='st'>"No next-line therapy initiated"</span>,
                                                              <span class='st'>"Second next-line therapy initiated"</span>,
                                                              <span class='st'>"Ongoing on first next-line therapy"</span>, <span class='st'>"PD"</span>, <span class='st'>"Death"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>### Add N to treatment label and order by TRT01PN</span>
<span class='va'>ADTTE_locf</span><span class='op'>$</span><span class='va'>TRT01P_label</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/with.html'>with</a></span><span class='op'>(</span><span class='va'>ADTTE_locf</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>TRT01P</span>, <span class='st'>" (N="</span>, <span class='va'>N</span>, <span class='st'>")"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>ADTTE_locf</span><span class='op'>$</span><span class='va'>TRT01P_label</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/reorder.factor.html'>reorder</a></span><span class='op'>(</span><span class='va'>ADTTE_locf</span><span class='op'>$</span><span class='va'>TRT01P_label</span>, <span class='va'>ADTTE_locf</span><span class='op'>$</span><span class='va'>TRT01PN</span><span class='op'>)</span>

<span class='co'>### Stacked area chart</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>ADTTE_locf</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>AVAL_wk</span>, y <span class='op'>=</span> <span class='va'>pct</span>, fill <span class='op'>=</span> <span class='va'>EVNTDESC</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_area</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.6</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='va'>TRT01P_label</span> <span class='op'>~</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>160</span><span class='op'>)</span>, breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>160</span>, by <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span>, name <span class='op'>=</span> <span class='st'>"Week"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, by <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span>, 
                     name <span class='op'>=</span> <span class='st'>"Cumulative proportion with event / censoring"</span>, expand <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>52</span>, alpha <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_grey.html'>scale_fill_grey</a></span><span class='op'>(</span>start <span class='op'>=</span> <span class='fl'>0.8</span>, end <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>legend.position <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.15</span>, <span class='fl'>0.85</span><span class='op'>)</span>, legend.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,  <span class='co'># remove legend title and set legend position</span>
        panel.grid.major.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, panel.grid.minor.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,  <span class='co'># remove vertical gridlines</span>
        panel.grid.minor.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>  <span class='co'># remove horizontal minor gridlines</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Combination of tablemab + vismab leads to less deaths during first 52 weeks of study treatment"</span><span class='op'>)</span>

<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsave.html'>ggsave</a></span><span class='op'>(</span>filename <span class='op'>=</span> <span class='st'>"2020-04-08-markusv_area.png"</span>, width <span class='op'>=</span> <span class='fl'>19.3</span>, height <span class='op'>=</span> <span class='fl'>9</span>, units <span class='op'>=</span> <span class='st'>"in"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><a href="#example2">Back to blog</a></p>
<p><a id="example3 code"></a></p>
<h2 id="example-3-sas">Example 3 (SAS)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">filename urlFile url <span class="st">&#39;https://raw.githubusercontent.com/VIS-SIG/Wonderful-Wednesdays/master/data/2020/2020-04-08/2020-04-08-psi-vissig-adtte.csv&#39;</span>;</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="op">*--------------------------------</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">Import Procedure</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="op">---------------------------------</span>;</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">data ADTTE </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    (<span class="dt">label=</span><span class="st">&#39;Time-to-Event&#39;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">     <span class="dt">compress=</span>yes</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">);</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">infile urlFile </a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  delimiter =<span class="st"> &#39;,&#39;</span> </a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  missover </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  dsd </a>
<a class="sourceLine" id="cb1-16" data-line-number="16">  lrecl=<span class="dv">32767</span> </a>
<a class="sourceLine" id="cb1-17" data-line-number="17">  firstobs=<span class="dv">2</span>;</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">attrib </a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    STUDYID length=<span class="er">$</span><span class="dv">20</span> format=<span class="er">$</span><span class="fl">20.</span> informat=<span class="er">$</span><span class="fl">20.</span> label=<span class="st">&#39;the study identifier&#39;</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    SUBJID length=<span class="dv">8</span> format=<span class="fl">8.</span> informat=<span class="fl">8.</span> label=<span class="st">&#39;subject identifier&#39;</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    USUBJID length=<span class="er">$</span><span class="dv">40</span> format=<span class="er">$</span><span class="fl">40.</span> informat=<span class="er">$</span><span class="fl">40.</span> label=<span class="st">&#39;unique subject iddentifier&#39;</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">    AGE length=<span class="dv">8</span> format=<span class="fl">8.</span> informat=<span class="fl">8.</span> label=<span class="st">&#39;age at randomisation (years)&#39;</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">    STR01 length=<span class="er">$</span><span class="dv">8</span> format=<span class="er">$</span><span class="fl">8.</span> informat=<span class="fl">8.</span> label=<span class="st">&#39;Hormone receptor status at randomisation&#39;</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">    STR01N length=<span class="dv">3</span> format=<span class="fl">3.</span> informat=<span class="fl">3.</span> label=<span class="st">&#39;Hormone receptor positive (Numeric)&#39;</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    STR01L length=<span class="er">$</span><span class="dv">30</span> format=<span class="er">$</span><span class="fl">30.</span> informat=<span class="er">$</span><span class="fl">30.</span> label=<span class="st">&#39;Hormone receptor positive (Long format)&#39;</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    STR02 length=<span class="er">$</span><span class="dv">30</span> format=<span class="er">$</span><span class="fl">30.</span> informat=<span class="er">$</span><span class="fl">30.</span> label=<span class="st">&#39;Prior Radiotherapy at randomisation&#39;</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    STR02N length=<span class="dv">3</span> format=<span class="fl">3.</span> informat=<span class="fl">3.</span> label=<span class="st">&#39;Prior Radiotherapy at randomisation (Numeric)&#39;</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">    STR02L length=<span class="er">$</span><span class="dv">40</span> format=<span class="er">$</span><span class="fl">40.</span> informat=<span class="er">$</span><span class="fl">40.</span> label=<span class="st">&#39;Prior Radiotherapy at randomisation (Long format)&#39;</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    TRT01P length=<span class="er">$</span><span class="dv">40</span> format=<span class="er">$</span><span class="fl">40.</span> informat=<span class="er">$</span><span class="fl">40.</span> label=<span class="st">&#39;Planned treatment assigned at randomisation&#39;</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30">    TRT01PN length=<span class="dv">8</span> format=<span class="fl">8.</span> informat=<span class="fl">8.</span> label=<span class="st">&#39;Planned treatment assigned at randomisation (Numeric)&#39;</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">    PARAM length=<span class="er">$</span><span class="dv">40</span> format=<span class="er">$</span><span class="fl">40.</span> informat=<span class="fl">40.</span> label=<span class="st">&#39;Analysis parameter - Progression free survival&#39;</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32">    PARAMCD length=<span class="er">$</span><span class="dv">10</span> format=<span class="er">$</span><span class="fl">10.</span> informat=<span class="er">$</span><span class="fl">10.</span> label=<span class="st">&#39;Analysis parameter code&#39;</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">    AVAL length=<span class="dv">8</span> format=<span class="fl">8.</span> informat=<span class="fl">8.</span> label=<span class="st">&#39;Analysis value (time to event [days])&#39;</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    CNSR length=<span class="dv">3</span> format=<span class="fl">3.</span> informat=<span class="fl">3.</span> label=<span class="st">&#39;Censoring (0 = Event, 1 = censored)&#39;</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">    EVNTDESC length=<span class="st"> </span><span class="er">$</span><span class="dv">34</span> format=<span class="er">$</span><span class="fl">34.</span> informat=<span class="er">$</span><span class="fl">34.</span> label=<span class="st">&#39;Event description&#39;</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">    CNSDTDSC length=<span class="er">$</span><span class="dv">33</span> format=<span class="er">$</span><span class="fl">33.</span> informat=<span class="er">$</span><span class="fl">34.</span> label=<span class="st">&#39;Censoring description&#39;</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    DCTREAS length=<span class="er">$</span><span class="dv">25</span> format=<span class="er">$</span><span class="fl">25.</span> informat=<span class="fl">34.</span> label=<span class="st">&#39;Discontinuation from study reason&#39;</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">;</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">input</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">  STUDYID SUBJID USUBJID AGE STR01 STR01N STR01L    </a>
<a class="sourceLine" id="cb1-41" data-line-number="41">  STR02 STR02N STR02L   TRT01P TRT01PN PARAM PARAMCD    </a>
<a class="sourceLine" id="cb1-42" data-line-number="42">  AVAL CNSR EVNTDESC CNSDTDSC DCTREAS;</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">run;</a>
<a class="sourceLine" id="cb1-44" data-line-number="44"></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46">data TIME_TO_EVENT</a>
<a class="sourceLine" id="cb1-47" data-line-number="47">( <span class="dt">keep =</span>  Patient Age_at_Start Age_Group Age_at_End Survival_Days Survival_Weeks</a>
<a class="sourceLine" id="cb1-48" data-line-number="48">          Full_Years Hormone_Receptor_Status Prior_Radiotherapy</a>
<a class="sourceLine" id="cb1-49" data-line-number="49">        Treatment_No Treatment Censoring Death Discontinuation Discontinuation_Reason</a>
<a class="sourceLine" id="cb1-50" data-line-number="50">);</a>
<a class="sourceLine" id="cb1-51" data-line-number="51"></a>
<a class="sourceLine" id="cb1-52" data-line-number="52">attrib</a>
<a class="sourceLine" id="cb1-53" data-line-number="53">    Patient length=<span class="dv">8</span> </a>
<a class="sourceLine" id="cb1-54" data-line-number="54">    Age_at_Start length=<span class="dv">8</span></a>
<a class="sourceLine" id="cb1-55" data-line-number="55">    Age_Group length=<span class="er">$</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1-56" data-line-number="56">    Age_at_End length=<span class="dv">8</span></a>
<a class="sourceLine" id="cb1-57" data-line-number="57">    Survival_Days length=<span class="dv">8</span> label=<span class="st">&#39;Survival Days&#39;</span></a>
<a class="sourceLine" id="cb1-58" data-line-number="58">    Full_Years length=<span class="dv">8</span></a>
<a class="sourceLine" id="cb1-59" data-line-number="59">    Hormone_Receptor_Status length=<span class="er">$</span><span class="dv">8</span> </a>
<a class="sourceLine" id="cb1-60" data-line-number="60">    Prior_Radiotherapy length=<span class="er">$</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1-61" data-line-number="61">    Treatment_No length=<span class="dv">8</span></a>
<a class="sourceLine" id="cb1-62" data-line-number="62">    Treatment length=<span class="er">$</span><span class="dv">40</span></a>
<a class="sourceLine" id="cb1-63" data-line-number="63">    Censoring length=<span class="dv">8</span></a>
<a class="sourceLine" id="cb1-64" data-line-number="64">    Death length=<span class="dv">8</span></a>
<a class="sourceLine" id="cb1-65" data-line-number="65">    Discontinuation length=<span class="er">$</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1-66" data-line-number="66">    Discontinuation_Reason length=<span class="er">$</span><span class="dv">25</span> </a>
<a class="sourceLine" id="cb1-67" data-line-number="67">;</a>
<a class="sourceLine" id="cb1-68" data-line-number="68">set RECD.ADTTE;</a>
<a class="sourceLine" id="cb1-69" data-line-number="69"></a>
<a class="sourceLine" id="cb1-70" data-line-number="70">    Patient =<span class="st"> </span>SUBJID;</a>
<a class="sourceLine" id="cb1-71" data-line-number="71">    Age_at_Start =<span class="st"> </span>AGE;</a>
<a class="sourceLine" id="cb1-72" data-line-number="72">    Survival_Days =<span class="st"> </span>AVAL;</a>
<a class="sourceLine" id="cb1-73" data-line-number="73">    Survival_Weeks =<span class="st"> </span><span class="kw">int</span>(Survival_Days<span class="op">/</span><span class="dv">7</span>);</a>
<a class="sourceLine" id="cb1-74" data-line-number="74">    Full_Years =<span class="st"> </span><span class="kw">int</span>(Survival_Days<span class="op">/</span><span class="fl">365.25</span>);</a>
<a class="sourceLine" id="cb1-75" data-line-number="75">    Age_at_End =<span class="st"> </span>Age_at_Start <span class="op">+</span><span class="st"> </span>Full_Years;</a>
<a class="sourceLine" id="cb1-76" data-line-number="76">    Hormone_Receptor_Status =<span class="st"> </span>STR01;</a>
<a class="sourceLine" id="cb1-77" data-line-number="77">    Prior_Radiotherapy =<span class="st"> </span><span class="kw">ifc</span>(<span class="dt">STR02N=</span><span class="dv">1</span>,<span class="st">&#39;Y&#39;</span>,<span class="st">&#39;N&#39;</span>);</a>
<a class="sourceLine" id="cb1-78" data-line-number="78">    Treatment_No =<span class="st"> </span>TRT01PN;</a>
<a class="sourceLine" id="cb1-79" data-line-number="79">    Treatment =<span class="st"> </span>TRT01P;</a>
<a class="sourceLine" id="cb1-80" data-line-number="80">    Censoring =<span class="st"> </span>CNSR;</a>
<a class="sourceLine" id="cb1-81" data-line-number="81">    Death =<span class="st"> </span><span class="kw">ifc</span>(<span class="dt">EVNTDESC =</span> <span class="st">&#39;Death&#39;</span>,<span class="dv">1</span>,<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb1-82" data-line-number="82">    Discontinuation =<span class="st"> </span><span class="kw">ifc</span>(<span class="dt">DCTREAS =</span> <span class="st">&#39;NA&#39;</span>,<span class="st">&#39;N&#39;</span>,<span class="st">&#39;Y&#39;</span>);</a>
<a class="sourceLine" id="cb1-83" data-line-number="83">    Discontinuation_Reason =<span class="st"> </span><span class="kw">propcase</span>(DCTREAS);</a>
<a class="sourceLine" id="cb1-84" data-line-number="84"></a>
<a class="sourceLine" id="cb1-85" data-line-number="85">    <span class="cf">if</span> Discontinuation =<span class="st"> &#39;N&#39;</span> then Discontinuation_Reason =<span class="st"> &#39;Not applicable&#39;</span>;</a>
<a class="sourceLine" id="cb1-86" data-line-number="86"></a>
<a class="sourceLine" id="cb1-87" data-line-number="87">    <span class="cf">if</span> Age_at_Start <span class="op">&lt;=</span><span class="st"> </span><span class="dv">50</span> then Age_Group =<span class="st"> &#39;25-50&#39;</span>;</a>
<a class="sourceLine" id="cb1-88" data-line-number="88">    <span class="cf">else</span> <span class="cf">if</span> <span class="dv">51</span> <span class="op">&lt;=</span><span class="st"> </span>Age_at_Start <span class="op">&lt;=</span><span class="st"> </span><span class="dv">60</span> then Age_Group =<span class="st"> &#39;51-60&#39;</span> ;</a>
<a class="sourceLine" id="cb1-89" data-line-number="89">    <span class="cf">else</span> <span class="cf">if</span> <span class="dv">61</span> <span class="op">&lt;=</span><span class="st"> </span>Age_at_Start <span class="op">&lt;=</span><span class="st"> </span><span class="dv">70</span> then Age_Group =<span class="st"> &#39;61-70&#39;</span> ;</a>
<a class="sourceLine" id="cb1-90" data-line-number="90">    <span class="cf">else</span> <span class="cf">if</span> <span class="dv">71</span> <span class="op">&lt;=</span><span class="st"> </span>Age_at_Start <span class="op">&lt;=</span><span class="st"> </span><span class="dv">80</span> then Age_Group =<span class="st"> &#39;71-80&#39;</span> ;</a>
<a class="sourceLine" id="cb1-91" data-line-number="91">    <span class="cf">else</span>  Age_Group =<span class="st"> &#39;81+&#39;</span> ;</a>
<a class="sourceLine" id="cb1-92" data-line-number="92">run;</a>
<a class="sourceLine" id="cb1-93" data-line-number="93"></a>
<a class="sourceLine" id="cb1-94" data-line-number="94"></a>
<a class="sourceLine" id="cb1-95" data-line-number="95">ods _all_ close;</a>
<a class="sourceLine" id="cb1-96" data-line-number="96">ods graphics on;</a>
<a class="sourceLine" id="cb1-97" data-line-number="97"></a>
<a class="sourceLine" id="cb1-98" data-line-number="98">ods output Survivalplot=SurvivalPlotData;</a>
<a class="sourceLine" id="cb1-99" data-line-number="99">proc lifetest data=TIME_TO_EVENT plots=<span class="kw">survival</span>(<span class="dt">atrisk=</span><span class="dv">0</span> to <span class="dv">2000</span> by <span class="dv">10</span>); </a>
<a class="sourceLine" id="cb1-100" data-line-number="100">    time Survival_Days <span class="op">*</span><span class="st"> </span><span class="kw">Death</span>(<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb1-101" data-line-number="101">    strata Treatment<span class="op">/</span><span class="st"> </span>test=logrank adjust=sidak;</a>
<a class="sourceLine" id="cb1-102" data-line-number="102">run; </a>
<a class="sourceLine" id="cb1-103" data-line-number="103"></a>
<a class="sourceLine" id="cb1-104" data-line-number="104"></a>
<a class="sourceLine" id="cb1-105" data-line-number="105"></a>
<a class="sourceLine" id="cb1-106" data-line-number="106"></a>
<a class="sourceLine" id="cb1-107" data-line-number="107"></a>
<a class="sourceLine" id="cb1-108" data-line-number="108"></a>
<a class="sourceLine" id="cb1-109" data-line-number="109">proc sql;</a>
<a class="sourceLine" id="cb1-110" data-line-number="110">create table time</a>
<a class="sourceLine" id="cb1-111" data-line-number="111">as</a>
<a class="sourceLine" id="cb1-112" data-line-number="112">select distinct time</a>
<a class="sourceLine" id="cb1-113" data-line-number="113">from SurvivalPlotData;</a>
<a class="sourceLine" id="cb1-114" data-line-number="114">quit;</a>
<a class="sourceLine" id="cb1-115" data-line-number="115"></a>
<a class="sourceLine" id="cb1-116" data-line-number="116"></a>
<a class="sourceLine" id="cb1-117" data-line-number="117">data time;</a>
<a class="sourceLine" id="cb1-118" data-line-number="118">set time end=eof;</a>
<a class="sourceLine" id="cb1-119" data-line-number="119">i=_n_;</a>
<a class="sourceLine" id="cb1-120" data-line-number="120"><span class="cf">if</span> eof then call <span class="kw">symput</span>(<span class="st">&#39;n&#39;</span>,_n_);</a>
<a class="sourceLine" id="cb1-121" data-line-number="121">run;</a>
<a class="sourceLine" id="cb1-122" data-line-number="122"></a>
<a class="sourceLine" id="cb1-123" data-line-number="123"></a>
<a class="sourceLine" id="cb1-124" data-line-number="124">%macro km;</a>
<a class="sourceLine" id="cb1-125" data-line-number="125"><span class="op">%do i=1 %</span>to <span class="op">&amp;</span>n<span class="op">+</span><span class="dv">10</span>;</a>
<a class="sourceLine" id="cb1-126" data-line-number="126"></a>
<a class="sourceLine" id="cb1-127" data-line-number="127">proc sql noprint;</a>
<a class="sourceLine" id="cb1-128" data-line-number="128">select <span class="kw">max</span>(Time) into<span class="op">:</span><span class="st"> </span>Time</a>
<a class="sourceLine" id="cb1-129" data-line-number="129">from Time</a>
<a class="sourceLine" id="cb1-130" data-line-number="130">where i <span class="op">&lt;=</span><span class="st"> </span><span class="er">&amp;</span>i.;</a>
<a class="sourceLine" id="cb1-131" data-line-number="131">quit;</a>
<a class="sourceLine" id="cb1-132" data-line-number="132"></a>
<a class="sourceLine" id="cb1-133" data-line-number="133">data SPD;</a>
<a class="sourceLine" id="cb1-134" data-line-number="134">set <span class="kw">SurvivalPlotData</span> (<span class="dt">where=</span>(Time le <span class="op">&amp;</span>Time.));</a>
<a class="sourceLine" id="cb1-135" data-line-number="135">run;</a>
<a class="sourceLine" id="cb1-136" data-line-number="136"></a>
<a class="sourceLine" id="cb1-137" data-line-number="137">proc sql;</a>
<a class="sourceLine" id="cb1-138" data-line-number="138">create table Survival_Pct</a>
<a class="sourceLine" id="cb1-139" data-line-number="139">as</a>
<a class="sourceLine" id="cb1-140" data-line-number="140">select      StratumNum,</a>
<a class="sourceLine" id="cb1-141" data-line-number="141">            <span class="kw">min</span>(Survival) as Survival,</a>
<a class="sourceLine" id="cb1-142" data-line-number="142">            <span class="kw">compress</span>(<span class="kw">put</span>(<span class="kw">min</span>(Survival),percent8<span class="fl">.1</span>)) as Survival_txt</a>
<a class="sourceLine" id="cb1-143" data-line-number="143">from        SPD </a>
<a class="sourceLine" id="cb1-144" data-line-number="144">where       Survival not=.</a>
<a class="sourceLine" id="cb1-145" data-line-number="145">group by    StratumNum;</a>
<a class="sourceLine" id="cb1-146" data-line-number="146">quit;</a>
<a class="sourceLine" id="cb1-147" data-line-number="147"></a>
<a class="sourceLine" id="cb1-148" data-line-number="148">data _null_;</a>
<a class="sourceLine" id="cb1-149" data-line-number="149">set Survival_Pct;</a>
<a class="sourceLine" id="cb1-150" data-line-number="150"><span class="cf">if</span> StratumNum =<span class="st"> </span><span class="dv">1</span> then do;</a>
<a class="sourceLine" id="cb1-151" data-line-number="151">    call <span class="kw">symput</span>(<span class="st">&#39;Trt_val_1&#39;</span>,Survival);</a>
<a class="sourceLine" id="cb1-152" data-line-number="152">    call <span class="kw">symputx</span>(<span class="st">&#39;Trt_txt_1&#39;</span>,Survival_txt);</a>
<a class="sourceLine" id="cb1-153" data-line-number="153">end;</a>
<a class="sourceLine" id="cb1-154" data-line-number="154"><span class="cf">if</span> StratumNum =<span class="st"> </span><span class="dv">2</span> then do;</a>
<a class="sourceLine" id="cb1-155" data-line-number="155">    call <span class="kw">symput</span>(<span class="st">&#39;Trt_val_2&#39;</span>,Survival);</a>
<a class="sourceLine" id="cb1-156" data-line-number="156">    call <span class="kw">symputx</span>(<span class="st">&#39;Trt_txt_2&#39;</span>,Survival_txt);</a>
<a class="sourceLine" id="cb1-157" data-line-number="157">end;</a>
<a class="sourceLine" id="cb1-158" data-line-number="158"><span class="cf">if</span> StratumNum =<span class="st"> </span><span class="dv">3</span> then do;</a>
<a class="sourceLine" id="cb1-159" data-line-number="159">    call <span class="kw">symput</span>(<span class="st">&#39;Trt_val_3&#39;</span>,Survival);</a>
<a class="sourceLine" id="cb1-160" data-line-number="160">    call <span class="kw">symputx</span>(<span class="st">&#39;Trt_txt_3&#39;</span>,Survival_txt);</a>
<a class="sourceLine" id="cb1-161" data-line-number="161">end;</a>
<a class="sourceLine" id="cb1-162" data-line-number="162"><span class="cf">if</span> StratumNum =<span class="st"> </span><span class="dv">4</span> then do;</a>
<a class="sourceLine" id="cb1-163" data-line-number="163">    call <span class="kw">symput</span>(<span class="st">&#39;Trt_val_4&#39;</span>,Survival);</a>
<a class="sourceLine" id="cb1-164" data-line-number="164">    call <span class="kw">symputx</span>(<span class="st">&#39;Trt_txt_4&#39;</span>,Survival_txt);</a>
<a class="sourceLine" id="cb1-165" data-line-number="165">end;</a>
<a class="sourceLine" id="cb1-166" data-line-number="166">run;</a>
<a class="sourceLine" id="cb1-167" data-line-number="167"></a>
<a class="sourceLine" id="cb1-168" data-line-number="168">title j=center font=calibri height=10pt <span class="st">&quot;Survival Day = &amp;Time&quot;</span>;</a>
<a class="sourceLine" id="cb1-169" data-line-number="169">proc sgplot data=SPD noborder nowall;</a>
<a class="sourceLine" id="cb1-170" data-line-number="170"> styleattrs datacontrastcolors=(CX003469 CX69b937 CXef7d04 CX00a6cb);</a>
<a class="sourceLine" id="cb1-171" data-line-number="171"> step x=time y=survival <span class="op">/</span><span class="st"> </span>group=stratum name=<span class="st">&#39;s&#39;</span>;</a>
<a class="sourceLine" id="cb1-172" data-line-number="172">  scatter x=time y=censored <span class="op">/</span><span class="st"> </span>markerattrs=(<span class="dt">symbol=</span>plus) name=<span class="st">&#39;c&#39;</span>;</a>
<a class="sourceLine" id="cb1-173" data-line-number="173">  scatter x=time y=censored <span class="op">/</span><span class="st"> </span>markerattrs=(<span class="dt">symbol=</span>plus) GROUP=stratum;</a>
<a class="sourceLine" id="cb1-174" data-line-number="174"></a>
<a class="sourceLine" id="cb1-175" data-line-number="175">  keylegend <span class="st">&#39;c&#39;</span> <span class="op">/</span><span class="st"> </span>location=inside position=topright valueattrs =<span class="st"> </span>(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt);</a>
<a class="sourceLine" id="cb1-176" data-line-number="176">  keylegend <span class="st">&#39;s&#39;</span> <span class="op">/</span><span class="st"> </span>linelength=<span class="dv">20</span> valueattrs =<span class="st"> </span>(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt);</a>
<a class="sourceLine" id="cb1-177" data-line-number="177">  xaxis</a>
<a class="sourceLine" id="cb1-178" data-line-number="178">    values =<span class="st"> </span>(<span class="dv">0</span> to <span class="dv">2000</span> by <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb1-179" data-line-number="179">    valueattrs =<span class="st"> </span>(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt) </a>
<a class="sourceLine" id="cb1-180" data-line-number="180">    labelattrs =<span class="st"> </span>(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt) </a>
<a class="sourceLine" id="cb1-181" data-line-number="181">    label =<span class="st"> &#39;x - Survival Days / y - *Survival Probability&#39;</span></a>
<a class="sourceLine" id="cb1-182" data-line-number="182">  ;</a>
<a class="sourceLine" id="cb1-183" data-line-number="183">  yaxis </a>
<a class="sourceLine" id="cb1-184" data-line-number="184">    valueattrs =<span class="st"> </span>(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt) </a>
<a class="sourceLine" id="cb1-185" data-line-number="185">    labelattrs =<span class="st"> </span>(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt) </a>
<a class="sourceLine" id="cb1-186" data-line-number="186">    values =<span class="st"> </span>(<span class="dv">0</span> to <span class="dv">1</span> by <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb1-187" data-line-number="187">    labelpos =<span class="st"> </span>top</a>
<a class="sourceLine" id="cb1-188" data-line-number="188">    label=<span class="st">&#39;*&#39;</span></a>
<a class="sourceLine" id="cb1-189" data-line-number="189">  ;</a>
<a class="sourceLine" id="cb1-190" data-line-number="190"></a>
<a class="sourceLine" id="cb1-191" data-line-number="191"><span class="op">%if &amp;Time. ge 84 %</span>then %do;</a>
<a class="sourceLine" id="cb1-192" data-line-number="192">refline <span class="dv">84</span> <span class="op">/</span><span class="st"> </span>axis=x </a>
<a class="sourceLine" id="cb1-193" data-line-number="193">    lineattrs=(<span class="dt">pattern=</span>dash <span class="dt">color=</span>lightgrey) label=<span class="st">&#39;12 Weeks&#39;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt);</a>
<a class="sourceLine" id="cb1-194" data-line-number="194">%end;</a>
<a class="sourceLine" id="cb1-195" data-line-number="195"></a>
<a class="sourceLine" id="cb1-196" data-line-number="196"><span class="op">%if &amp;Time. ge 365 %</span>then %do;</a>
<a class="sourceLine" id="cb1-197" data-line-number="197">refline <span class="dv">365</span> <span class="op">/</span><span class="st"> </span>axis=x </a>
<a class="sourceLine" id="cb1-198" data-line-number="198">    lineattrs=(<span class="dt">pattern=</span>dash <span class="dt">color=</span>lightgrey) label=<span class="st">&#39;52 Weeks / 1 Year&#39;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt);</a>
<a class="sourceLine" id="cb1-199" data-line-number="199">%end;</a>
<a class="sourceLine" id="cb1-200" data-line-number="200"></a>
<a class="sourceLine" id="cb1-201" data-line-number="201"><span class="op">%if &amp;Time. ge 730 %</span>then %do;</a>
<a class="sourceLine" id="cb1-202" data-line-number="202">refline <span class="dv">730</span> <span class="op">/</span><span class="st"> </span>axis=x  </a>
<a class="sourceLine" id="cb1-203" data-line-number="203">    lineattrs=(<span class="dt">pattern=</span>dash <span class="dt">color=</span>lightgrey) label=<span class="st">&#39;2 Years&#39;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt);</a>
<a class="sourceLine" id="cb1-204" data-line-number="204">%end;</a>
<a class="sourceLine" id="cb1-205" data-line-number="205"></a>
<a class="sourceLine" id="cb1-206" data-line-number="206"><span class="op">%if &amp;Time. ge 1095 %</span>then %do;</a>
<a class="sourceLine" id="cb1-207" data-line-number="207">refline <span class="dv">1095</span> <span class="op">/</span><span class="st"> </span>axis=x </a>
<a class="sourceLine" id="cb1-208" data-line-number="208">    lineattrs=(<span class="dt">pattern=</span>dash <span class="dt">color=</span>lightgrey) label=<span class="st">&#39;3 Years&#39;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt)  ;</a>
<a class="sourceLine" id="cb1-209" data-line-number="209">%end;</a>
<a class="sourceLine" id="cb1-210" data-line-number="210"></a>
<a class="sourceLine" id="cb1-211" data-line-number="211"><span class="op">%if &amp;Time. ge 1461 %</span>then %do;</a>
<a class="sourceLine" id="cb1-212" data-line-number="212">refline <span class="dv">1461</span> <span class="op">/</span><span class="st"> </span>axis=x </a>
<a class="sourceLine" id="cb1-213" data-line-number="213">    lineattrs=(<span class="dt">pattern=</span>dash <span class="dt">color=</span>lightgrey) label=<span class="st">&#39;4 Years&#39;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt)  ;</a>
<a class="sourceLine" id="cb1-214" data-line-number="214">%end;</a>
<a class="sourceLine" id="cb1-215" data-line-number="215"></a>
<a class="sourceLine" id="cb1-216" data-line-number="216"><span class="op">%if &amp;Time. ge 1826 %</span>then %do;</a>
<a class="sourceLine" id="cb1-217" data-line-number="217">refline <span class="dv">1826</span> <span class="op">/</span><span class="st"> </span>axis=x </a>
<a class="sourceLine" id="cb1-218" data-line-number="218">    lineattrs=(<span class="dt">pattern=</span>dash <span class="dt">color=</span>lightgrey) label=<span class="st">&#39;5 Years&#39;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt)  ;</a>
<a class="sourceLine" id="cb1-219" data-line-number="219">%end;</a>
<a class="sourceLine" id="cb1-220" data-line-number="220"></a>
<a class="sourceLine" id="cb1-221" data-line-number="221">refline <span class="op">&amp;</span>Trt_val_<span class="fl">1.</span> <span class="op">/</span><span class="st"> </span>axis=y</a>
<a class="sourceLine" id="cb1-222" data-line-number="222">    lineattrs=(<span class="dt">pattern=</span>thindot <span class="dt">color=</span>CX003469) label=<span class="st">&quot;&amp;Trt_txt_1&quot;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt <span class="dt">color=</span>CX003469);</a>
<a class="sourceLine" id="cb1-223" data-line-number="223"></a>
<a class="sourceLine" id="cb1-224" data-line-number="224">refline <span class="op">&amp;</span>Trt_val_<span class="fl">2.</span> <span class="op">/</span><span class="st"> </span>axis=y</a>
<a class="sourceLine" id="cb1-225" data-line-number="225">    lineattrs=(<span class="dt">pattern=</span>thindot <span class="dt">color=</span>CX69b937) label=<span class="st">&quot;&amp;Trt_txt_2&quot;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt <span class="dt">color=</span>CX69b937);</a>
<a class="sourceLine" id="cb1-226" data-line-number="226"></a>
<a class="sourceLine" id="cb1-227" data-line-number="227">refline <span class="op">&amp;</span>Trt_val_<span class="fl">3.</span> <span class="op">/</span><span class="st"> </span>axis=y</a>
<a class="sourceLine" id="cb1-228" data-line-number="228">    lineattrs=(<span class="dt">pattern=</span>thindot <span class="dt">color=</span>CXef7d04) label=<span class="st">&quot;&amp;Trt_txt_3&quot;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt <span class="dt">color=</span>CXef7d04);</a>
<a class="sourceLine" id="cb1-229" data-line-number="229"></a>
<a class="sourceLine" id="cb1-230" data-line-number="230">refline <span class="op">&amp;</span>Trt_val_<span class="fl">4.</span> <span class="op">/</span><span class="st"> </span>axis=y</a>
<a class="sourceLine" id="cb1-231" data-line-number="231">    lineattrs=(<span class="dt">pattern=</span>thindot <span class="dt">color=</span>CX00a6cb) label=<span class="st">&quot;&amp;Trt_txt_4&quot;</span> labelattrs=(<span class="dt">family=</span>calibri <span class="dt">size=</span>10pt <span class="dt">color=</span>CX00a6cb);</a>
<a class="sourceLine" id="cb1-232" data-line-number="232">run;</a>
<a class="sourceLine" id="cb1-233" data-line-number="233"></a>
<a class="sourceLine" id="cb1-234" data-line-number="234">title;</a>
<a class="sourceLine" id="cb1-235" data-line-number="235"></a>
<a class="sourceLine" id="cb1-236" data-line-number="236"></a>
<a class="sourceLine" id="cb1-237" data-line-number="237">%end;</a>
<a class="sourceLine" id="cb1-238" data-line-number="238">%mend;</a>
<a class="sourceLine" id="cb1-239" data-line-number="239"></a>
<a class="sourceLine" id="cb1-240" data-line-number="240"><span class="op">/</span><span class="er">*</span><span class="st"> </span>Create the combined graph. <span class="op">*</span><span class="er">/</span></a>
<a class="sourceLine" id="cb1-241" data-line-number="241"></a>
<a class="sourceLine" id="cb1-242" data-line-number="242"></a>
<a class="sourceLine" id="cb1-243" data-line-number="243">options papersize=a4 printerpath=gif animation=start animduration=<span class="fl">0.05</span> animloop=no noanimoverlay nodate nonumber spool;</a>
<a class="sourceLine" id="cb1-244" data-line-number="244">ods printer file=<span class="st">&quot;c:</span><span class="ch">\t</span><span class="st">emp\KM_Treatment.gif&quot;</span>;</a>
<a class="sourceLine" id="cb1-245" data-line-number="245"></a>
<a class="sourceLine" id="cb1-246" data-line-number="246">ods graphics <span class="op">/</span><span class="st"> </span>width=10in height=10in  scale=on imagefmt=GIF;</a>
<a class="sourceLine" id="cb1-247" data-line-number="247">%km;</a>
<a class="sourceLine" id="cb1-248" data-line-number="248"></a>
<a class="sourceLine" id="cb1-249" data-line-number="249">options printerpath=gif animation=stop;</a>
<a class="sourceLine" id="cb1-250" data-line-number="250">ods printer close;</a></code></pre></div>
</div>
<p><a href="#example3">Back to blog</a></p>
<p><a id="example4 code"></a></p>
<h2 id="example-4-r-and-readme.txt">Example 4 (R and readme.txt)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>## PSI_April_KM_v1_0</span>

<span class='co'>## load in packages</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://shiny.rstudio.com'>shiny</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>shinyWidgets</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tidyverse</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>shinycssloaders</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://broom.tidymodels.org/'>broom</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>survminer</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>plotly</span><span class='op'>)</span>


<span class='va'>tick</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/icon.html'>icon</a></span><span class='op'>(</span><span class='st'>"check"</span><span class='op'>)</span>

<span class='va'>Orange</span> <span class='op'>&lt;-</span> <span class='st'>"#EF7F04"</span>
<span class='va'>Green</span> <span class='op'>&lt;-</span> <span class='st'>"#68B937"</span>
<span class='va'>Blue</span> <span class='op'>&lt;-</span> <span class='st'>"#00A6CB"</span>
<span class='va'>Grey</span> <span class='op'>&lt;-</span> <span class='st'>"#4E5053"</span>
<span class='va'>Darkblue</span> <span class='op'>&lt;-</span> <span class='st'>"#003569"</span>
<span class='va'>Yellow</span> <span class='op'>&lt;-</span> <span class='st'>"#FFBB2D"</span>

<span class='va'>ADTTE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>'2020-04-08-psi-vissig-adtte_v2.csv'</span><span class='op'>)</span>

<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>EVNTDESC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>EVNTDESC</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>

<span class='va'>ADTTE2</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE</span>
<span class='co'># Define UI for app that draws a bar chart in ggplot ----</span>

<span class='co'># Use a fluid Bootstrap layout</span>
<span class='va'>ui</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html'>fluidPage</a></span><span class='op'>(</span>    
  
  <span class='co'># Give the page a title</span>
  <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/titlePanel.html'>titlePanel</a></span><span class='op'>(</span><span class='st'>"Interactive Kaplan-Meier Plot"</span><span class='op'>)</span>,

  <span class='co'># Generate a row with a sidebar</span>
  <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/sidebarLayout.html'>sidebarLayout</a></span><span class='op'>(</span>

    <span class='co'># Define the sidebar with inputs for each plot separately</span>
    <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/sidebarLayout.html'>sidebarPanel</a></span><span class='op'>(</span>
      <span class='co'>## Conditional panels- only see first set of filters on first tab</span>
      <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/conditionalPanel.html'>conditionalPanel</a></span><span class='op'>(</span>condition <span class='op'>=</span> <span class='st'>"input.tabset == 'withn'"</span>,
                       <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>strong</a></span><span class='op'>(</span><span class='st'>"Filters for Plot:"</span><span class='op'>)</span>,
                       <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Strat1"</span>, <span class='st'>"Hormone receptor status:"</span>, 
                                           choices<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>, 
                                           selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>,
                                           inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
                       <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Strat2"</span>, <span class='st'>"Prior radiotherapy at randomisation:"</span>,
                                           choices<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>,
                                           selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>,
                                           inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
                       <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Trt"</span>, <span class='st'>"Treatment Arm:"</span>,
                                           choices<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>,
                                           selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>,
                                           inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
                       <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/sliderInput.html'>sliderInput</a></span><span class='op'>(</span><span class='st'>"ptAGE"</span>, <span class='st'>"Age Range:"</span>,
                                   min <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>, max <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>,
                                   value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"min"</span>,<span class='st'>"max"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
      
      <span class='co'>## Conditional panels- only see second set of filters on second tab</span>
      <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/conditionalPanel.html'>conditionalPanel</a></span><span class='op'>(</span>
        condition <span class='op'>=</span> <span class='st'>"input.tabset == 'QuantComp'"</span>,
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>strong</a></span><span class='op'>(</span><span class='st'>"Filters for Plot A:"</span><span class='op'>)</span>,
        <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Strat1a"</span>, <span class='st'>"Hormone receptor status:"</span>, 
                            choices<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>, 
                            selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>,
                            inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
        <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Strat2a"</span>, <span class='st'>"Prior radiotherapy at randomisation:"</span>,
                            choices<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>,
                            selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>,
                            inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
        <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Trta"</span>, <span class='st'>"Treatment Arm:"</span>,
                            choices<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>,
                            selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>,
                            inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/sliderInput.html'>sliderInput</a></span><span class='op'>(</span><span class='st'>"ptAGEa"</span>, <span class='st'>"Age Range:"</span>,
                    min <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>, max <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>,
                    value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"min"</span>,<span class='st'>"max"</span><span class='op'>)</span><span class='op'>)</span>,
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>br</a></span><span class='op'>(</span><span class='op'>)</span>,
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>hr</a></span><span class='op'>(</span><span class='op'>)</span>,
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>br</a></span><span class='op'>(</span><span class='op'>)</span>,
        
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>strong</a></span><span class='op'>(</span><span class='st'>"Filters for Plot B:"</span><span class='op'>)</span>,
        <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Strat1b"</span>, <span class='st'>"Hormone receptor status:"</span>, 
                            choices<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>, 
                            selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE2</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>,
                            inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
        <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Strat2b"</span>, <span class='st'>"Prior radiotherapy at randomisation:"</span>,
                            choices<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>,
                            selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>,
                            inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
        <span class='fu'>prettyCheckboxGroup</span><span class='op'>(</span><span class='st'>"Trtb"</span>, <span class='st'>"Treatment Arm:"</span>,
                            choices<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>,
                            selected <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/levels.html'>levels</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>,
                            inline <span class='op'>=</span> <span class='cn'>TRUE</span>, icon <span class='op'>=</span> <span class='va'>tick</span><span class='op'>)</span>,
        <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/sliderInput.html'>sliderInput</a></span><span class='op'>(</span><span class='st'>"ptAGEb"</span>, <span class='st'>"Age Range:"</span>,
                    min <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>, max <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>AGE</span><span class='op'>)</span>,
                    value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"min"</span>,<span class='st'>"max"</span><span class='op'>)</span><span class='op'>)</span>,
        
      <span class='op'>)</span>,
      <span class='st'>"Events are defined as death or disease progression."</span>
    <span class='op'>)</span>,
    
    
    
    
    
    <span class='co'># Create a spot for the plot</span>
    <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/sidebarLayout.html'>mainPanel</a></span><span class='op'>(</span>
      <span class='co'>## Creates two separate panels- one for KM plot and number of patients, one for two KM plots to allow comparisons</span>
      <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/tabsetPanel.html'>tabsetPanel</a></span><span class='op'>(</span>type <span class='op'>=</span> <span class='st'>"tabs"</span>,
                  id <span class='op'>=</span> <span class='st'>"tabset"</span>,
                  <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/tabPanel.html'>tabPanel</a></span><span class='op'>(</span><span class='st'>"KM plot with number of patients"</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/plotOutput.html'>plotOutput</a></span><span class='op'>(</span><span class='st'>"PlotA"</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>br</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>hr</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>br</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/plotOutput.html'>plotOutput</a></span><span class='op'>(</span><span class='st'>"PlotB"</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='st'>"withn"</span><span class='op'>)</span>,
                  
                  
                  <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/tabPanel.html'>tabPanel</a></span><span class='op'>(</span><span class='st'>"KM plots to compare between subgroups"</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/plotOutput.html'>plotOutput</a></span><span class='op'>(</span><span class='st'>"PlotC"</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>br</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>hr</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/builder.html'>br</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/plotOutput.html'>plotOutput</a></span><span class='op'>(</span><span class='st'>"PlotD"</span><span class='op'>)</span>, value <span class='op'>=</span> <span class='st'>"QuantComp"</span><span class='op'>)</span>
                  
                  
      <span class='op'>)</span>
      
    <span class='op'>)</span>  
  <span class='op'>)</span>
  
<span class='op'>)</span>  


<span class='co'># Define a server for the Shiny app</span>


<span class='va'>server</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>input</span>, <span class='va'>output</span><span class='op'>)</span> <span class='op'>{</span>
  
  <span class='co'># Create four separate plots based on inputs</span>
  
  <span class='co'>## Fit model and plot KM curve for first tab</span>
  <span class='va'>output</span><span class='op'>$</span><span class='va'>PlotA</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/renderPlot.html'>renderPlot</a></span><span class='op'>(</span><span class='op'>{</span>
    
    <span class='co'>#Filter and Subset Data</span>
    
    <span class='va'>plotdata</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>STR01L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat1</span>, <span class='va'>STR02L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat2</span>,
                                 <span class='va'>TRT01P</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Trt</span><span class='op'>)</span>
    <span class='va'>plotdata2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>plotdata</span>,
                        <span class='va'>AGE</span>  <span class='op'>&gt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGE</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&amp;</span> <span class='va'>AGE</span> <span class='op'>&lt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGE</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>  
    

    
    <span class='va'>fita</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>plotdata2</span><span class='op'>)</span>
    <span class='va'>plot</span> <span class='op'>&lt;-</span>        <span class='fu'>ggsurvplot</span><span class='op'>(</span><span class='va'>fita</span>,
                              risk.table <span class='op'>=</span> <span class='cn'>TRUE</span>,
                              data <span class='op'>=</span> <span class='va'>plotdata2</span>,
                              <span class='co'># size = 0.0001,</span>
                              censor.shape <span class='op'>=</span> <span class='st'>""</span>,
                              palette <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TRT01P=tablemab + vismab 52 weeks"</span> <span class='op'>=</span> <span class='va'>Darkblue</span>,<span class='st'>"TRT01P=tablemab x 12 week -&gt; vismab 34 weeks"</span> <span class='op'>=</span> <span class='va'>Green</span>, 
                                          <span class='st'>"TRT01P=tablemab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Blue</span>, <span class='st'>"TRT01P=vismab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Orange</span><span class='op'>)</span>,
                              <span class='co'># risk.table = 'nrisk_cumcensor',</span>
                              <span class='co'># tables.theme = theme_cleantable(),</span>
                              <span class='co'># risk.table.col = "strata",</span>
                              <span class='co'># # cumevents = TRUE,</span>
                              title <span class='op'>=</span> <span class='st'>"Interactive Kaplan-Meier plot: Explore time to event across 4 treatment arms"</span>,
                              xlab <span class='op'>=</span> <span class='st'>"Time (days)"</span>,
                              ylab <span class='op'>=</span> <span class='st'>"Event free survival"</span>,
                              legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.18</span>,<span class='fl'>.25</span><span class='op'>)</span>,
                              legend.title <span class='op'>=</span> <span class='st'>"Treatment Group"</span>,
                              
                              <span class='co'># legend.labs = c("Control", "Treatment"),</span>
                              break.x.by <span class='op'>=</span> <span class='fl'>90</span>,
                              xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1980</span><span class='op'>)</span>,
                              ggtheme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> 
    <span class='va'>plot</span><span class='op'>$</span><span class='va'>plot</span> <span class='op'>+</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>365</span>, linetype<span class='op'>=</span><span class='st'>'dotted'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>1095</span>, linetype<span class='op'>=</span><span class='st'>'dashed'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>1825</span>, linetype<span class='op'>=</span><span class='st'>'solid'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>375</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 1"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1105</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 3"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1835</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 5"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> 
    
  <span class='op'>}</span><span class='op'>)</span>
  
  <span class='co'>## Filter data and pull out number of patients for n's at bottom of first tab</span>
  <span class='va'>output</span><span class='op'>$</span><span class='va'>PlotB</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/renderPlot.html'>renderPlot</a></span><span class='op'>(</span><span class='op'>{</span>
    <span class='va'>plotdata</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>STR01L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat1</span>, <span class='va'>STR02L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat2</span>,
                                 <span class='va'>TRT01P</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Trt</span><span class='op'>)</span>
    <span class='va'>plotdata2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>plotdata</span>,
                        <span class='va'>AGE</span>  <span class='op'>&gt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGE</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&amp;</span> <span class='va'>AGE</span> <span class='op'>&lt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGE</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>  
    
    
    
    <span class='va'>fita</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>plotdata2</span><span class='op'>)</span>
    <span class='va'>plot2</span> <span class='op'>&lt;-</span>        <span class='fu'>ggsurvplot</span><span class='op'>(</span><span class='va'>fita</span>,
                               data <span class='op'>=</span> <span class='va'>plotdata2</span>,
                               <span class='co'># size = 0.0001,</span>
                               censor.shape <span class='op'>=</span> <span class='st'>""</span>,
                               palette <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TRT01P=tablemab + vismab 52 weeks"</span> <span class='op'>=</span> <span class='va'>Darkblue</span>,<span class='st'>"TRT01P=tablemab x 12 week -&gt; vismab 34 weeks"</span> <span class='op'>=</span> <span class='va'>Green</span>, 
                                           <span class='st'>"TRT01P=tablemab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Blue</span>, <span class='st'>"TRT01P=vismab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Orange</span><span class='op'>)</span>,
                               <span class='co'># risk.table = 'nrisk_cumcensor',</span>
                               <span class='co'># tables.theme = theme_cleantable(),</span>
                               <span class='co'># risk.table.col = "strata",</span>
                               <span class='co'># # cumevents = TRUE,</span>
                               <span class='co'>#title = "Interactive Kaplan-Meier plot: Explore time to event across 4 treatment arms",</span>
                               title <span class='op'>=</span> <span class='st'>"Interactive Kaplan-Meier plot: Explore time to event across 4 treatment arms"</span>,
                               xlab <span class='op'>=</span> <span class='st'>"Time (days)"</span>,
                               ylab <span class='op'>=</span> <span class='st'>"Event free survival"</span>,
                               legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.18</span>,<span class='fl'>.25</span><span class='op'>)</span>,
                               legend.title <span class='op'>=</span> <span class='st'>"Treatment Group"</span>,
                               break.x.by <span class='op'>=</span> <span class='fl'>180</span>,
                               xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1980</span><span class='op'>)</span>,
                               ggtheme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span>,
                               risk.table <span class='op'>=</span> <span class='cn'>TRUE</span>, 
                               risk.table.col <span class='op'>=</span> <span class='st'>"strata"</span>,  
                               risk.table.title<span class='op'>=</span><span class='st'>"Patients remaining in study"</span>
    <span class='op'>)</span> 
    <span class='va'>plot2</span><span class='op'>$</span><span class='va'>table</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>
      axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
      axis.ticks.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
      legend.position <span class='op'>=</span> <span class='st'>"none"</span>
    <span class='op'>)</span>
    
  <span class='op'>}</span><span class='op'>)</span>  
<span class='co'>## Filter data and create KM plot for top of second tab</span>
  <span class='va'>output</span><span class='op'>$</span><span class='va'>PlotC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/renderPlot.html'>renderPlot</a></span><span class='op'>(</span><span class='op'>{</span>
    
    <span class='co'>#Filter and Subset Data</span>
    
    <span class='va'>plotdatc</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>STR01L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat1a</span>, <span class='va'>STR02L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat2a</span>,
                                 <span class='va'>TRT01P</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Trta</span><span class='op'>)</span>
    <span class='va'>plotdata2c</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>plotdatc</span>,
                         <span class='va'>AGE</span>  <span class='op'>&gt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGEa</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&amp;</span> <span class='va'>AGE</span> <span class='op'>&lt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGEa</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>  
    
    
    
    <span class='va'>fitc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>plotdata2c</span><span class='op'>)</span>
    <span class='va'>plotb</span> <span class='op'>&lt;-</span>        <span class='fu'>ggsurvplot</span><span class='op'>(</span><span class='va'>fitc</span>,
                               risk.table <span class='op'>=</span> <span class='cn'>TRUE</span>,
                               data <span class='op'>=</span> <span class='va'>plotdata2c</span>,
                               <span class='co'># size = 0.0001,</span>
                               censor.shape <span class='op'>=</span> <span class='st'>""</span>,
                               censor <span class='op'>=</span> <span class='cn'>FALSE</span>,
                               palette <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TRT01P=tablemab + vismab 52 weeks"</span> <span class='op'>=</span> <span class='va'>Darkblue</span>,<span class='st'>"TRT01P=tablemab x 12 week -&gt; vismab 34 weeks"</span> <span class='op'>=</span> <span class='va'>Green</span>, 
                                           <span class='st'>"TRT01P=tablemab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Blue</span>, <span class='st'>"TRT01P=vismab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Orange</span><span class='op'>)</span>,
                               <span class='co'># risk.table = 'nrisk_cumcensor',</span>
                               <span class='co'># tables.theme = theme_cleantable(),</span>
                               <span class='co'># risk.table.col = "strata",</span>
                               <span class='co'># # cumevents = TRUE,</span>
                               title <span class='op'>=</span> <span class='st'>"Plot A:"</span>,
                               xlab <span class='op'>=</span> <span class='st'>"Time (days)"</span>,
                               ylab <span class='op'>=</span> <span class='st'>"Event free survival"</span>,
                               legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.18</span>,<span class='fl'>.25</span><span class='op'>)</span>,
                               legend.title <span class='op'>=</span> <span class='st'>"Treatment Group"</span>,
                               
                               <span class='co'># legend.labs = c("Control", "Treatment"),</span>
                               break.x.by <span class='op'>=</span> <span class='fl'>90</span>,
                               xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1980</span><span class='op'>)</span>,
                               ggtheme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> 
    <span class='va'>plotb</span><span class='op'>$</span><span class='va'>plot</span> <span class='op'>+</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>365</span>, linetype<span class='op'>=</span><span class='st'>'dotted'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>1095</span>, linetype<span class='op'>=</span><span class='st'>'dashed'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>1825</span>, linetype<span class='op'>=</span><span class='st'>'solid'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>375</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 1"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1105</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 3"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1835</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 5"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span>
    
  <span class='op'>}</span><span class='op'>)</span>
  
  
<span class='co'>## Filter data and create KM plot for bottom of second tab  </span>
  <span class='va'>output</span><span class='op'>$</span><span class='va'>PlotD</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/renderPlot.html'>renderPlot</a></span><span class='op'>(</span><span class='op'>{</span>
    
    <span class='co'>#Filter and Subset Data</span>
    
    <span class='va'>plotdatad</span> <span class='op'>&lt;-</span> <span class='va'>ADTTE</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>STR01L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat1b</span>, <span class='va'>STR02L</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Strat2b</span>,
                                  <span class='va'>TRT01P</span> <span class='op'>%in%</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>Trtb</span><span class='op'>)</span>
    <span class='va'>plotdata2d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>plotdatad</span>,
                         <span class='va'>AGE</span>  <span class='op'>&gt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGEb</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span> <span class='op'>&amp;</span> <span class='va'>AGE</span> <span class='op'>&lt;=</span> <span class='va'>input</span><span class='op'>$</span><span class='va'>ptAGEb</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>  
    
    
    
    <span class='va'>fitd</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>plotdata2d</span><span class='op'>)</span>
    <span class='va'>plotd</span> <span class='op'>&lt;-</span>        <span class='fu'>ggsurvplot</span><span class='op'>(</span><span class='va'>fitd</span>,
                               risk.table <span class='op'>=</span> <span class='cn'>TRUE</span>,
                               data <span class='op'>=</span> <span class='va'>plotdata2d</span>,
                               censor <span class='op'>=</span> <span class='cn'>FALSE</span>,
                               <span class='co'># size = 0.0001,</span>
                               censor.shape <span class='op'>=</span> <span class='cn'>FALSE</span>,
                               palette <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"TRT01P=tablemab + vismab 52 weeks"</span> <span class='op'>=</span> <span class='va'>Darkblue</span>,<span class='st'>"TRT01P=tablemab x 12 week -&gt; vismab 34 weeks"</span> <span class='op'>=</span> <span class='va'>Green</span>, 
                                           <span class='st'>"TRT01P=tablemab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Blue</span>, <span class='st'>"TRT01P=vismab x 52 weeks"</span> <span class='op'>=</span> <span class='va'>Orange</span><span class='op'>)</span>,
                               <span class='co'># risk.table = 'nrisk_cumcensor',</span>
                               <span class='co'># tables.theme = theme_cleantable(),</span>
                               <span class='co'># risk.table.col = "strata",</span>
                               <span class='co'># # cumevents = TRUE,</span>
                               title <span class='op'>=</span> <span class='st'>"Plot B:"</span>,
                               xlab <span class='op'>=</span> <span class='st'>"Time (days)"</span>,
                               ylab <span class='op'>=</span> <span class='st'>"Event free survival"</span>,
                               legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>.18</span>,<span class='fl'>.25</span><span class='op'>)</span>,
                               legend.title <span class='op'>=</span> <span class='st'>"Treatment Group"</span>,
                               <span class='co'># legend.labs = c("Control", "Treatment"),</span>
                               break.x.by <span class='op'>=</span> <span class='fl'>90</span>,
                               xlim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1980</span><span class='op'>)</span>,
                               ggtheme <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> 
    <span class='va'>plotd</span><span class='op'>$</span><span class='va'>plot</span> <span class='op'>+</span>  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>365</span>, linetype<span class='op'>=</span><span class='st'>'dotted'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>1095</span>, linetype<span class='op'>=</span><span class='st'>'dashed'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept<span class='op'>=</span><span class='fl'>1825</span>, linetype<span class='op'>=</span><span class='st'>'solid'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>375</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 1"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1105</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 3"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span> <span class='op'>+</span>
      <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1835</span>, y <span class='op'>=</span> <span class='fl'>0</span>, label <span class='op'>=</span> <span class='st'>"Year 5"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, size <span class='op'>=</span> <span class='fl'>4.5</span><span class='op'>)</span>
    
    
    
    
  <span class='op'>}</span><span class='op'>)</span>
<span class='op'>}</span>    





<span class='co'># Create Shiny app ----</span>
<span class='fu'><a href='https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html'>shinyApp</a></span><span class='op'>(</span>ui <span class='op'>=</span> <span class='va'>ui</span>, server <span class='op'>=</span> <span class='va'>server</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">Interactive Kaplan Meier</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="op">-</span><span class="st"> </span>Overall, this app produces a standard Kaplan Meier curve and associated data table </a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="op">-</span><span class="st"> </span>The app contains two tabs<span class="op">:</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">    </span><span class="op">-</span><span class="st"> &quot;KM Plot with number of patients&quot;</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    <span class="op">-</span><span class="st"> </span>This tab displays a standard plot and data table. The options <span class="cf">in</span> the left hand bar allow <span class="cf">for</span> updates to the chart <span class="cf">in</span> real time.</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="op">-</span><span class="st"> </span>the data table is colour coded to match the legend <span class="cf">in</span> the chart</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    <span class="op">-</span><span class="st"> </span>Labels not presented on the Y<span class="op">-</span>axis so that the chart and the table align</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    <span class="op">-</span><span class="st"> &quot;KM Plots to compare between subgroups&quot;</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">    <span class="op">-</span><span class="st"> </span>two plots are displayed vertically</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    <span class="op">-</span><span class="st"> </span>use options on the left hand panel to compare information between different scenarios</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">    <span class="op">-</span><span class="st"> </span>future improvements include<span class="op">:</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">        </span><span class="op">-</span><span class="st"> </span>Displaying N at start of treatment on the chart <span class="cf">for</span> the selected scenarios</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">        <span class="op">-</span><span class="st"> </span>adding a <span class="st">&quot;hover&quot;</span> to indicate the N remaining at each timepoint <span class="cf">for</span> the selected scenarios</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">Online file</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">Opens as a webpage<span class="op">/</span>hosted shiny app from shortcut or link<span class="op">-</span><span class="st"> </span>https<span class="op">:</span><span class="er">//</span>avpco.shinyapps.io<span class="op">/</span>PSI_April_KM_v1_<span class="dv">0</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">R file</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="fl">1.</span> Click <span class="st">&quot;run app&quot;</span> (with data saved as <span class="dv">2020-04-08</span><span class="op">-</span>psi<span class="op">-</span>vissig<span class="op">-</span>adtte_v2.csv <span class="cf">in</span> the same folder<span class="op">/</span>working directory)</a>
<a class="sourceLine" id="cb2-21" data-line-number="21"></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">Video file</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">Video demonstration of the Rshiny app</a></code></pre></div>
</div>
<p><a href="#example4">Back to blog</a></p>
<p><a id="example4 code"></a></p>
<h2 id="example-5-r-and-readme.txt">Example 5 (R and readme.txt)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='co'>## Heatmap for PSI Wonderful Wednesday - April</span>

<span class='co'>## Load required packages ====</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tidyverse</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>plotly</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>

<span class='co'>## Read in data and assign colours ====</span>

<span class='va'>Orange</span> <span class='op'>&lt;-</span> <span class='st'>"#EF7F04"</span>
<span class='va'>Green</span> <span class='op'>&lt;-</span> <span class='st'>"#68B937"</span>
<span class='va'>Blue</span> <span class='op'>&lt;-</span> <span class='st'>"#00A6CB"</span>
<span class='va'>Grey</span> <span class='op'>&lt;-</span> <span class='st'>"#4E5053"</span>
<span class='va'>Darkblue</span> <span class='op'>&lt;-</span> <span class='st'>"#003569"</span>
<span class='va'>Yellow</span> <span class='op'>&lt;-</span> <span class='st'>"#FFBB2D"</span>

<span class='co'>## Assumes data saved in same working directory</span>
<span class='va'>ADTTE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='st'>'2020-04-08-psi-vissig-adtte_v2.csv'</span><span class='op'>)</span>

<span class='co'>## change variable types as necessary</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR01L</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>STR02L</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>TRT01P</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>DCTREAS</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>DCTREAS</span><span class='op'>)</span>
<span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>EVNTDESC</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>ADTTE</span><span class='op'>$</span><span class='va'>EVNTDESC</span><span class='op'>)</span>


<span class='co'>## Fit survival model and reformat ====</span>
<span class='va'>fita</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>ADTTE</span><span class='op'>)</span>

<span class='co'>## Pull out survival function data</span>
<span class='va'>surv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span><span class='op'>(</span><span class='va'>fita</span><span class='op'>$</span><span class='va'>surv</span><span class='op'>)</span>

<span class='co'>## Add treatment to survival data</span>
<span class='va'>treatment</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"TMB+VMB 52wks"</span>, times <span class='op'>=</span> <span class='fl'>433</span><span class='op'>)</span>, 
               <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"TMB 12wks,VMB 34wks"</span>, times <span class='op'>=</span> <span class='fl'>454</span><span class='op'>)</span>, 
               <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"TMB 52wks"</span>, times <span class='op'>=</span> <span class='fl'>427</span><span class='op'>)</span>, 
               <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"VMB 52wks"</span>, times <span class='op'>=</span> <span class='fl'>445</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Combine survival function data, treatment arm and time</span>
<span class='va'>surv_time</span> <span class='op'>&lt;-</span> <span class='va'>surv</span> <span class='op'>%&gt;%</span>
  <span class='fu'>add_column</span><span class='op'>(</span>Days<span class='op'>=</span><span class='va'>fita</span><span class='op'>$</span><span class='va'>time</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>add_column</span><span class='op'>(</span>Treatment_Arm<span class='op'>=</span><span class='va'>treatment</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>survival<span class='op'>=</span><span class='va'>`fita$surv`</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>Days</span><span class='op'>)</span>

<span class='co'>## create shell with all possible days in</span>

<span class='va'>shell</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>Days <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>1944</span>, times <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>,
                Treatment_Arm <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"TMB+VMB 52wks"</span>, times <span class='op'>=</span> <span class='fl'>1944</span><span class='op'>)</span>, 
                                  <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"TMB 12wks,VMB 34wks"</span>, times <span class='op'>=</span> <span class='fl'>1944</span><span class='op'>)</span>, 
                                  <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"TMB 52wks"</span>, times <span class='op'>=</span> <span class='fl'>1944</span><span class='op'>)</span>, 
                                  <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>"VMB 52wks"</span>, times <span class='op'>=</span> <span class='fl'>1944</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## merge on from surv time for when we have a survival value</span>
<span class='co'>## Add 1 for first day at each (nobody's dead yet)</span>
<span class='co'>## Copy survival function values down into empty rows to replicate KM curve horizontal line</span>

<span class='va'>full_surv</span> <span class='op'>&lt;-</span> <span class='va'>shell</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>surv_time</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>survival <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Days</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='va'>survival</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'>## add 1 for first day as all alive</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'>## make sure we don't copy from one trt to the next</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>Days</span>, .by_group <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'>## make sure in correct analysis day order</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html'>fill</a></span><span class='op'>(</span><span class='va'>survival</span><span class='op'>)</span> <span class='op'>%&gt;%</span>  <span class='co'>## fills in empty survival function values</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>testdf</span> <span class='op'>&lt;-</span> <span class='va'>full_surv</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>id_cols <span class='op'>=</span> <span class='va'>Days</span>, names_from <span class='op'>=</span> <span class='va'>Treatment_Arm</span>, values_from <span class='op'>=</span> <span class='va'>survival</span><span class='op'>)</span>

<span class='va'>Flag</span> <span class='op'>&lt;-</span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
  <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 12wks,VMB 34wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 52wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 12wks,VMB 34wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB+VMB 52wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 12wks,VMB 34wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`VMB 52wks`</span> <span class='op'>~</span> <span class='fl'>3</span>,
  
  <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 12wks,VMB 34wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB+VMB 52wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`VMB 52wks`</span> <span class='op'>~</span> <span class='fl'>1</span>,
  
  <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB+VMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 12wks,VMB 34wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB+VMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 52wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB+VMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`VMB 52wks`</span> <span class='op'>~</span> <span class='fl'>4</span>,
  
  <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`VMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 12wks,VMB 34wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`VMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB 52wks`</span> <span class='op'>&amp;</span> 
    <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`VMB 52wks`</span><span class='op'>&gt;</span> <span class='va'>testdf</span><span class='op'>$</span><span class='va'>`TMB+VMB 52wks`</span> <span class='op'>~</span> <span class='fl'>2</span>
<span class='op'>)</span>



<span class='co'>## Creating text labels for hover functionality ====</span>
<span class='co'>## Add in text for labels, adding extra blank space for alignment</span>
<span class='va'>full_surv2</span> <span class='op'>&lt;-</span> <span class='va'>full_surv</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>text1 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>survival</span>, digits <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>": "</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>text2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span>condition <span class='op'>=</span> <span class='va'>Treatment_Arm</span> <span class='op'>==</span> <span class='st'>"TMB 12wks,VMB 34wks"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>survival</span>, digits <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>":"</span><span class='op'>)</span>,
                         false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span>condition <span class='op'>=</span> <span class='va'>Treatment_Arm</span> <span class='op'>==</span> <span class='st'>"TMB+VMB 52wks"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>survival</span>, digits <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>":          "</span><span class='op'>)</span>,
                                         false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span> <span class='op'>==</span> <span class='st'>"VMB 52wks"</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>survival</span>, digits <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>":                   "</span><span class='op'>)</span>,
                                                         false <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>Treatment_Arm</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>survival</span>, digits <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>":                   "</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>


<span class='co'>## Remove survival values (now in text2) and reformat data to wide format</span>
<span class='va'>full_surv3</span> <span class='op'>&lt;-</span> <span class='va'>full_surv2</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>survival</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_wider</span><span class='op'>(</span>id_cols <span class='op'>=</span> <span class='va'>Days</span>, names_from <span class='op'>=</span> <span class='va'>Treatment_Arm</span>, values_from <span class='op'>=</span> <span class='va'>text2</span><span class='op'>)</span> 

<span class='va'>full_surv3</span><span class='op'>$</span><span class='va'>Flag</span> <span class='op'>&lt;-</span> <span class='va'>Flag</span>

<span class='va'>full_surv3</span> <span class='op'>&lt;-</span> <span class='va'>full_surv3</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Flag <span class='op'>=</span> <span class='fu'>replace_na</span><span class='op'>(</span><span class='va'>Flag</span>, <span class='fl'>99</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Merge formatted labels (full_surv3) back to data with survival values (so all labels for each observation) </span>
<span class='co'>## Combines label with /n separator to ensure each on different line</span>
<span class='co'>## Makes the value that is hovered over bold</span>

<span class='va'>full_surv4</span> <span class='op'>&lt;-</span> <span class='va'>full_surv2</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>full_surv3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>text2 <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>`TMB 52wks`</span>,<span class='va'>`VMB 52wks`</span>,<span class='va'>`TMB 12wks,VMB 34wks`</span>,  <span class='va'>`TMB+VMB 52wks`</span>, sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>boldtrt <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"&lt;b&gt;"</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span> <span class='op'>==</span><span class='fl'>1</span>, <span class='va'>`TMB 52wks`</span>, 
                                        false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span><span class='op'>==</span><span class='fl'>2</span>, <span class='va'>`VMB 52wks`</span>, 
                                                        false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span><span class='op'>==</span><span class='fl'>3</span>, <span class='va'>`TMB 12wks,VMB 34wks`</span>,
                                                                        false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span><span class='op'>==</span><span class='fl'>4</span>,<span class='va'>`TMB+VMB 52wks`</span>,
                                                                                        false <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,<span class='st'>"&lt;/b&gt;"</span>, sep <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>text3 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>boldtrt</span>, <span class='va'>`VMB 52wks`</span>,<span class='va'>`TMB 12wks,VMB 34wks`</span>,  <span class='va'>`TMB+VMB 52wks`</span>, sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span>,
                         false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span> <span class='op'>==</span> <span class='fl'>2</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>`TMB 52wks`</span>,<span class='va'>boldtrt</span>,<span class='va'>`TMB 12wks,VMB 34wks`</span>,  <span class='va'>`TMB+VMB 52wks`</span>, sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span>,
                                         false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span> <span class='op'>==</span> <span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>`TMB 52wks`</span>,<span class='va'>`VMB 52wks`</span>,<span class='va'>boldtrt</span>,  <span class='va'>`TMB+VMB 52wks`</span>, sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span>,
                                                         false <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>Flag</span> <span class='op'>==</span> <span class='fl'>4</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>`TMB 52wks`</span>, <span class='va'>`VMB 52wks`</span>,<span class='va'>`TMB 12wks,VMB 34wks`</span>,  <span class='va'>boldtrt</span>, sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span>,
                                                                         false <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>`TMB 52wks`</span>,<span class='va'>`VMB 52wks`</span>,<span class='va'>`TMB 12wks,VMB 34wks`</span>, <span class='va'>`TMB+VMB 52wks`</span>, sep <span class='op'>=</span> <span class='st'>"\n"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Reorder factors so that axis will match with label order ====</span>
<span class='va'>full_surv4</span><span class='op'>$</span><span class='va'>Treatment_Arm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>full_surv4</span><span class='op'>$</span><span class='va'>Treatment_Arm</span><span class='op'>)</span>

<span class='va'>full_surv4</span><span class='op'>$</span><span class='va'>Treatment_Arm</span> <span class='op'>&lt;-</span> <span class='fu'>fct_relevel</span><span class='op'>(</span><span class='va'>full_surv4</span><span class='op'>$</span><span class='va'>Treatment_Arm</span>, <span class='st'>"TMB+VMB 52wks"</span>, <span class='st'>"TMB 12wks,VMB 34wks"</span>, <span class='st'>"VMB 52wks"</span>,<span class='st'>"TMB 52wks"</span><span class='op'>)</span>

<span class='co'>## Create plot ====</span>

<span class='co'>## Create ggplot object</span>
<span class='va'>plot</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>full_surv4</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Days</span>, y <span class='op'>=</span> <span class='va'>Treatment_Arm</span>, text <span class='op'>=</span> <span class='va'>text3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_gradient.html'>scale_fill_gradient2</a></span><span class='op'>(</span>
    low <span class='op'>=</span> <span class='va'>Darkblue</span>,
    high <span class='op'>=</span> <span class='va'>Green</span>,
    mid <span class='op'>=</span> <span class='st'>'white'</span>, 
    midpoint <span class='op'>=</span> <span class='fl'>0.5</span>,
    limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>,
    name <span class='op'>=</span> <span class='st'>"Survival\nFunction"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='st'>"Treatment Arm"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.grid.major <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, panel.grid.minor <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## Create static heatmap and add titles</span>
<span class='va'>plot</span> <span class='op'>&lt;-</span> <span class='va'>plot</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_tile</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>survival</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>plot</span> <span class='op'>&lt;-</span>  <span class='va'>plot</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1000</span>, y <span class='op'>=</span> <span class='fl'>5.2</span>, label <span class='op'>=</span> <span class='st'>" "</span>, hjust <span class='op'>=</span> <span class='st'>"centered"</span>, vjust <span class='op'>=</span> <span class='st'>"top"</span>, size<span class='op'>=</span><span class='fl'>7</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1000</span>, y <span class='op'>=</span> <span class='fl'>5.05</span>, label <span class='op'>=</span> <span class='st'>"Combining therapies leads to better outcomes after one year"</span>, hjust <span class='op'>=</span> <span class='st'>"centered"</span>, vjust <span class='op'>=</span> <span class='st'>"top"</span>, size<span class='op'>=</span><span class='fl'>7</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1000</span>, y <span class='op'>=</span> <span class='fl'>4.6</span>, label <span class='op'>=</span> <span class='st'>"...but simultaneous treatment has a better overall median survival"</span>, hjust <span class='op'>=</span> <span class='st'>"centered"</span>, vjust <span class='op'>=</span> <span class='st'>"top"</span>, size<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>365</span>, xend<span class='op'>=</span><span class='fl'>365</span>, y<span class='op'>=</span><span class='fl'>0.5</span>, yend<span class='op'>=</span><span class='fl'>4.5</span>, linetype<span class='op'>=</span><span class='st'>'dotted'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>1095</span>, xend<span class='op'>=</span><span class='fl'>1095</span>, y<span class='op'>=</span><span class='fl'>0.5</span>, yend<span class='op'>=</span><span class='fl'>4.5</span>, linetype<span class='op'>=</span><span class='st'>'dashed'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='fl'>1825</span>, xend<span class='op'>=</span><span class='fl'>1825</span>, y<span class='op'>=</span><span class='fl'>0.5</span>, yend<span class='op'>=</span><span class='fl'>4.5</span>, linetype<span class='op'>=</span><span class='st'>'solid'</span>, col <span class='op'>=</span> <span class='st'>"black"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>375</span>, y <span class='op'>=</span> <span class='fl'>0.4</span>, label <span class='op'>=</span> <span class='st'>"Year 1"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, vjust <span class='op'>=</span> <span class='st'>"bottom"</span>, size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1105</span>, y <span class='op'>=</span> <span class='fl'>0.4</span>, label <span class='op'>=</span> <span class='st'>"Year 3"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, vjust <span class='op'>=</span> <span class='st'>"bottom"</span>, size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1835</span>, y <span class='op'>=</span> <span class='fl'>0.4</span>, label <span class='op'>=</span> <span class='st'>"Year 5"</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, vjust <span class='op'>=</span> <span class='st'>"bottom"</span>, size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span>geom <span class='op'>=</span> <span class='st'>"text"</span>, x <span class='op'>=</span> <span class='fl'>1835</span>, y <span class='op'>=</span> <span class='fl'>0.3</span>, label <span class='op'>=</span> <span class='st'>" "</span>, hjust <span class='op'>=</span> <span class='st'>"left"</span>, vjust <span class='op'>=</span> <span class='st'>"bottom"</span>, size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> 


<span class='co'>## Transform to plotly to add hover text</span>

<span class='fu'>ggplotly</span><span class='op'>(</span><span class='va'>plot</span>, tooltip <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"text3"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/graphics/layout.html'>layout</a></span><span class='op'>(</span>hoverlabel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>align <span class='op'>=</span> <span class='st'>"left"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">HeatMap<span class="op">-</span>Lan Meier</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="op">-</span><span class="st"> </span>The HeatMap<span class="op">-</span>Lan Meier uses survival functions from a Kaplan Mier curve to show the transition <span class="cf">in</span> the proportion of events. </a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="op">-</span><span class="st"> </span>The benefit of the KM information <span class="cf">in</span> this format is that it <span class="st">&quot;separates&quot;</span> the curves <span class="cf">while</span> supplying the same information. Overlaps which obsure data are now not an issue</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="op">-</span><span class="st"> </span>The <span class="st">&quot;proportion&quot;</span> with events is not as intuitive using a colour coded heat map. As such we have included a hover function. </a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="op">-</span><span class="st"> </span>Placing the mouse over any element of the chart will show the survival <span class="cf">function</span> <span class="cf">for</span> all treatment arms.</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="op">-</span><span class="st"> </span>The treatment arm and associated survival <span class="cf">function</span> <span class="cf">in</span> _BOLD_ represent the most favourable condition at the selected timepoint.  </a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">HTML File</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">Opens heat map as a webpage</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">R file</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="fl">1.</span> Save <span class="kw">dataset</span> (as <span class="dv">2020-04-08</span><span class="op">-</span>psi<span class="op">-</span>vissig<span class="op">-</span>adtte_v2.csv) <span class="cf">in</span> same folder<span class="op">/</span>working directory as code</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="fl">2.</span> Install associated packages</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="fl">3.</span> Run the R code</a></code></pre></div>
</div>
<p><a href="#example5">Back to blog</a></p>
<p><a id="example5 code"></a></p>
<h2 id="example-5-r">Example 5 (R)</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>tidyverse</span><span class='op'>)</span>    
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://broom.tidymodels.org/'>broom</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>here</span><span class='op'>)</span>

<span class='co'># load data</span>
<span class='va'>ADTTE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://readr.tidyverse.org/reference/read_delim.html'>read_csv</a></span><span class='op'>(</span><span class='fu'>here</span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>'2020-04-08-psi-vissig-adtte.csv'</span><span class='op'>)</span><span class='op'>)</span>


<span class='co'># Set up meta data for the report</span>
<span class='co'>#-------------------------------------------------</span>
<span class='va'>title</span> <span class='op'>&lt;-</span> <span class='st'>"Evidence of improved progression-free survival for combo over monotherapy"</span>
<span class='va'>subtitle</span> <span class='op'>&lt;-</span> <span class='st'>"Kaplan-Meier estimates over time including 95% uncertainty interval"</span>
<span class='va'>source</span> <span class='op'>&lt;-</span> <span class='st'>"*The number of patients at risk (and events) are displayed the time point reference.
Data source: https://github.com/VIS-SIG/Wonderful-Wednesdays/tree/master/data/2020/2020-04-08"</span>
<span class='va'>y_axis</span> <span class='op'>&lt;-</span> <span class='st'>"Progression free survival"</span>
<span class='va'>x_axis</span> <span class='op'>&lt;-</span> <span class='st'>"Time [days]*"</span>


<span class='co'>############################################</span>
<span class='co'>## Survival model for KM and risk set</span>
<span class='co'>############################################</span>

<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>, data <span class='op'>=</span> <span class='va'>ADTTE</span>, conf.type <span class='op'>=</span> <span class='st'>'log-log'</span> <span class='op'>)</span> 
<span class='va'>sumfit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>fit</span>, times <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>250</span>, <span class='fl'>500</span>, <span class='fl'>750</span>, <span class='fl'>1000</span>, <span class='fl'>1250</span>, <span class='fl'>1500</span>, <span class='fl'>1750</span>, <span class='fl'>2000</span><span class='op'>)</span><span class='op'>)</span> 


<span class='co'># tidy KM curve by treatment for plotting</span>
<span class='co'>#-------------------------------------------</span>
<span class='va'>km</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>AVAL</span>, <span class='va'>CNSR</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>TRT01P</span>,
          data <span class='op'>=</span> <span class='va'>ADTTE</span>,
          conf.type <span class='op'>=</span> <span class='st'>'log-log'</span><span class='op'>)</span>  <span class='op'>%&gt;%</span>
  <span class='fu'>broom</span><span class='fu'>::</span><span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>strata</span>, <span class='st'>"TRT01P="</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
    <span class='va'>group</span>,
    levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
      <span class='st'>"tablemab + vismab 52 weeks"</span>,
      <span class='st'>"tablemab x 12 week -&gt; vismab 34 weeks"</span>,
      <span class='st'>"vismab x 52 weeks"</span>,
      <span class='st'>"tablemab x 52 weeks"</span>
    <span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span>

<span class='co'># tidy KM curve by treatment for small multiples</span>
<span class='co'># this is a second data set to pass in for plotting</span>
<span class='co'># ghost lines of each treatment </span>
<span class='co'>#-------------------------------------------</span>
<span class='va'>km_sm</span> <span class='op'>&lt;-</span> <span class='va'>km</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>group2 <span class='op'>=</span> <span class='va'>group</span><span class='op'>)</span>


<span class='co'># Calculate risk set for annotations</span>
<span class='co'>#------------------------------------------</span>
<span class='va'>risk_data</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
    time <span class='op'>=</span>  <span class='va'>sumfit</span><span class='op'>$</span><span class='va'>time</span>,
    group <span class='op'>=</span> <span class='va'>sumfit</span><span class='op'>$</span><span class='va'>strata</span>,
    n.risk <span class='op'>=</span>   <span class='va'>sumfit</span><span class='op'>$</span><span class='va'>n.risk</span>,
    n.events <span class='op'>=</span> <span class='va'>sumfit</span><span class='op'>$</span><span class='va'>n.event</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    group <span class='op'>=</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>group</span>, <span class='st'>"TRT01P="</span><span class='op'>)</span>,
    label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>n.risk</span>, <span class='st'>" ("</span>, <span class='va'>n.events</span>, <span class='st'>")"</span><span class='op'>)</span>,
    y_pos <span class='op'>=</span> <span class='fl'>0.01</span>
  <span class='op'>)</span>


<span class='co'>############################################</span>
<span class='co'>## Create the plot</span>
<span class='co'>############################################</span>

<span class='va'>plot</span> <span class='op'>&lt;-</span>
  <span class='va'>km</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>time</span>, y <span class='op'>=</span> <span class='va'>estimate</span>, group <span class='op'>=</span> <span class='va'>group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='co'>## draw the ghost lines of each treatment by facet. Force the group facet to null</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_step</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/transform.html'>transform</a></span><span class='op'>(</span><span class='va'>td2</span>, group <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='va'>time</span>, <span class='va'>estimate</span>, group <span class='op'>=</span> <span class='va'>group2</span><span class='op'>)</span>,
    size <span class='op'>=</span> <span class='fl'>0.75</span>,
    color <span class='op'>=</span> <span class='st'>"#000000"</span>,
    alpha <span class='op'>=</span> <span class='fl'>0.15</span>
  <span class='op'>)</span> <span class='op'>+</span>
  
  <span class='co'>## draw km lines</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_ribbon.html'>geom_ribbon</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>0.1</span>, fill <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_step</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span>
  
  <span class='co'>## draw risk set</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>risk_data</span>, mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>time</span>, y <span class='op'>=</span> <span class='va'>y_pos</span>, label <span class='op'>=</span> <span class='va'>label</span>, group <span class='op'>=</span> <span class='va'>group</span>, fill <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>, size <span class='op'>=</span> <span class='fl'>2.5</span><span class='op'>)</span> <span class='op'>+</span>
  
  <span class='co'>## asthetics of the plot</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>250</span>, <span class='fl'>500</span>, <span class='fl'>750</span>, <span class='fl'>1000</span>, <span class='fl'>1250</span>, <span class='fl'>1500</span>, <span class='fl'>1750</span>, <span class='fl'>2000</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0.25</span>, <span class='fl'>0.50</span>, <span class='fl'>0.75</span>, <span class='fl'>1</span><span class='op'>)</span>, limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>

  <span class='co'>## annotations</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='va'>title</span>,
       subtitle <span class='op'>=</span> <span class='va'>subtitle</span>,
       caption <span class='op'>=</span> <span class='va'>source</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='va'>x_axis</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='va'>y_axis</span><span class='op'>)</span> <span class='op'>+</span>
  
  <span class='co'># set up basic theme </span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>12</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>
    panel.grid.minor <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    legend.position <span class='op'>=</span> <span class='st'>"none"</span>
  <span class='op'>)</span> <span class='op'>+</span>
  
  <span class='co'># Set the entire chart region to a light gray color</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>color_background</span>, color <span class='op'>=</span> <span class='va'>color_background</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>plot.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>color_background</span>, color <span class='op'>=</span> <span class='va'>color_background</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.border <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_rect</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"grey"</span>, fill <span class='op'>=</span> <span class='cn'>NA</span>, size <span class='op'>=</span> <span class='fl'>0.35</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span> <span class='va'>group</span>, scales <span class='op'>=</span> <span class='st'>'free'</span>, ncol <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span> 

<span class='co'># Save plot to file</span>
<span class='co'>#-----------------------------------------</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsave.html'>ggsave</a></span><span class='op'>(</span>
  file <span class='op'>=</span> <span class='fu'>here</span><span class='op'>(</span><span class='st'>"figs"</span>, <span class='st'>"ww-km-plot.png"</span><span class='op'>)</span>,
  width <span class='op'>=</span> <span class='fl'>35</span>, height <span class='op'>=</span> <span class='fl'>20</span>, units <span class='op'>=</span> <span class='st'>"cm"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p><a href="#example6">Back to blog</a></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
